<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tepkime Hızı | Teorim</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-app: #f8fafc;
            --bg-panel: #ffffff;
            --col-accent: #f97316;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --radius: 16px;
        }

        body { 
            margin: 0; background: var(--bg-app); 
            font-family: 'Inter', sans-serif; 
            height: 100vh; display: flex; overflow: hidden; color: var(--text-main);
        }

        /* --- MOBİL UYARI --- */
        #mobile-warning { 
            display: none; position: fixed; inset: 0; 
            background: #0f172a; color: white; z-index: 9999; 
            flex-direction: column; align-items: center; justify-content: center; 
            text-align: center; padding: 20px; 
        }
        @media (max-width: 768px) or (orientation: portrait) { #mobile-warning { display: flex; } }
        @keyframes phoneBounce {
            0%, 100% { transform: translateY(0) rotate(-5deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }
        .phone-icon { animation: phoneBounce 1.5s infinite ease-in-out; }

        /* SOL PANEL */
        aside { 
            width: 340px; flex-shrink: 0; background: var(--bg-panel); 
            border-right: 1px solid var(--border); padding: 24px; 
            display: flex; flex-direction: column; gap: 20px; 
            z-index: 30; box-shadow: 4px 0 20px rgba(0,0,0,0.02);
            overflow-y: auto;
        }

        .section-title {
            font-size: 0.7rem; font-weight: 800; color: #64748b;
            text-transform: uppercase; letter-spacing: 1px;
            margin-bottom: 8px; border-bottom: 1px solid var(--border); padding-bottom: 4px;
        }

        .control-group { background: #f8fafc; padding: 16px; border-radius: var(--radius); border: 1px solid var(--border); }
        .prop-row { display: flex; flex-direction: column; gap: 6px; margin-bottom: 15px; font-size: 0.8rem; font-weight: 700; }
        .label-val { display: flex; justify-content: space-between; align-items: center; }
        input[type="range"] { width: 100%; accent-color: var(--col-accent); cursor: pointer; height: 4px; border-radius: 2px; }

        /* ANA ALAN */
        main { flex: 1; position: relative; background: #f8fafc; overflow: hidden; }
        canvas { display: block; width: 100%; height: 100%; }

        /* VERİ KARTI */
        .data-card {
            position: absolute; top: 20px; right: 20px;
            background: rgba(255, 255, 255, 0.95); padding: 20px;
            border-radius: var(--radius); border: 1px solid var(--border);
            min-width: 240px; backdrop-filter: blur(12px);
            box-shadow: 0 10px 40px -10px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>

    <div id="mobile-warning">
        <div class="phone-icon mb-6">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-20 w-20 text-orange-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" />
            </svg>
        </div>
        <h2 class="text-2xl font-bold mb-2">Yatay Moda Geçin</h2>
        <p class="text-slate-400 text-sm max-w-xs">Tepkime haznesini tam görebilmek için cihazı yan çevirin.</p>
    </div>

<aside>
    <div class="flex items-center gap-3 mb-2">
        <a href="../../dersler/kimya.html" class="p-2 hover:bg-orange-100 rounded-full text-orange-600 transition">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M15 19l-7-7 7-7" /></svg>
        </a>
        <h1 class="font-bold text-xl text-slate-800">Tepkime Hızı</h1>
    </div>

    <div class="section-title">Reaktif Miktarları</div>
    <div class="control-group">
        <div class="prop-row">
            <div class="label-val">
                <span class="text-blue-600">Reaktif A (Mavi)</span>
                <span id="valCountA" class="text-slate-800 font-bold">50</span>
            </div>
            <input type="range" id="slCountA" min="0" max="100" step="5" value="50">
        </div>

        <div class="prop-row">
            <div class="label-val">
                <span class="text-red-600">Reaktif B (Kırmızı)</span>
                <span id="valCountB" class="text-slate-800 font-bold">50</span>
            </div>
            <input type="range" id="slCountB" min="0" max="100" step="5" value="50">
        </div>
    </div>

    <div class="section-title mt-4">Ortam Koşulları</div>
    <div class="control-group">
        <div class="prop-row">
            <div class="label-val">
                <span class="text-slate-500">Sıcaklık (T)</span>
                <span id="valTemp" class="text-orange-600 font-bold">25 °C</span>
            </div>
            <input type="range" id="slTemp" min="0" max="100" step="10" value="25">
        </div>

        <div class="flex items-center justify-between mt-2">
            <span class="text-sm font-bold text-slate-600">Katalizör</span>
            <label class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" id="chkCat" class="sr-only peer" onchange="app.toggleCatalyst()">
                <div class="w-11 h-6 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-orange-500"></div>
            </label>
        </div>
    </div>

    <div class="mt-auto flex gap-2">
        <button class="flex-1 py-3 bg-slate-800 text-white rounded-xl font-bold text-xs hover:bg-slate-700 transition" onclick="app.start()">BAŞLAT</button>
        <button class="flex-1 py-3 bg-slate-100 text-slate-600 rounded-xl font-bold text-xs hover:bg-slate-200 transition" onclick="app.reset()">SIFIRLA</button>
    </div>
</aside>

<main>
    <div class="data-card">
        <div class="text-[10px] font-extrabold text-slate-400 uppercase mb-4 tracking-widest border-b border-slate-100 pb-2">Analiz</div>
        
        <div class="mb-4">
            <div class="flex justify-between items-end mb-1">
                <span class="text-xs font-bold text-slate-600">Ürün Oluşumu</span>
                <span class="text-xl font-black text-slate-800" id="valProductCount">0</span>
            </div>
            <div class="h-1.5 w-full bg-slate-100 rounded-full overflow-hidden">
                <div id="barProgress" class="h-full bg-orange-500 w-[0%] transition-all duration-300"></div>
            </div>
            <div class="flex justify-between text-[9px] text-slate-400 mt-1">
                <span>Başlangıç</span>
                <span>Potansiyel Maks.</span>
            </div>
        </div>

        <div class="flex justify-between items-center mb-2 text-xs">
            <span class="text-slate-500 font-medium">Reaksiyon Hızı:</span>
            <span id="valRate" class="font-mono font-bold text-orange-600">0.00 M/s</span>
        </div>

        <div class="flex justify-between items-center text-xs">
            <span class="text-slate-500 font-medium">Süre:</span>
            <span id="valTime" class="font-mono font-bold text-slate-800">0.0 s</span>
        </div>
    </div>

    <canvas id="simCanvas"></canvas>
</main>

<script>
    const app = {
        canvas: document.getElementById('simCanvas'),
        ctx: null,
        width: 0, height: 0,
        particles: [],
        isRunning: false,
        startTime: 0,
        elapsed: 0,
        
        // Parametreler
        countA: 50,
        countB: 50,
        temp: 25,
        hasCatalyst: false,
        activationEnergy: 60,

        // Kutu (Chamber) Tanımı
        box: { x: 0, y: 0, w: 0, h: 0 },
        
        init() {
            this.ctx = this.canvas.getContext('2d');
            this.resize();
            window.addEventListener('resize', () => this.resize());
            
            // Slider Listeners
            document.getElementById('slCountA').oninput = (e) => {
                this.countA = parseInt(e.target.value);
                document.getElementById('valCountA').innerText = this.countA;
                if(!this.isRunning) this.reset();
            };
            document.getElementById('slCountB').oninput = (e) => {
                this.countB = parseInt(e.target.value);
                document.getElementById('valCountB').innerText = this.countB;
                if(!this.isRunning) this.reset();
            };
            document.getElementById('slTemp').oninput = (e) => {
                this.temp = parseInt(e.target.value);
                document.getElementById('valTemp').innerText = this.temp + " °C";
                this.updateSpeeds();
            };

            this.reset();
            this.loop();
        },

        resize() {
            this.width = this.canvas.width = this.canvas.parentElement.clientWidth;
            this.height = this.canvas.height = this.canvas.parentElement.clientHeight;
            
            // Kutuyu merkeze yerleştir
            const boxW = Math.min(600, this.width * 0.8);
            const boxH = Math.min(400, this.height * 0.6);
            this.box = {
                x: (this.width - boxW) / 2,
                y: (this.height - boxH) / 2,
                w: boxW,
                h: boxH
            };
        },

        toggleCatalyst() {
            this.hasCatalyst = document.getElementById('chkCat').checked;
            this.activationEnergy = this.hasCatalyst ? 30 : 60;
        },

        start() {
            if(this.isRunning) return;
            this.isRunning = true;
            this.startTime = Date.now() - (this.elapsed * 1000);
        },

        reset() {
            this.isRunning = false;
            this.elapsed = 0;
            this.particles = [];
            this.updateUI(0, 0);

            // A Parçacıkları (Mavi)
            for(let i=0; i<this.countA; i++) this.spawnParticle('A');
            // B Parçacıkları (Kırmızı)
            for(let i=0; i<this.countB; i++) this.spawnParticle('B');
            
            this.updateSpeeds();
        },

        spawnParticle(type) {
            // Parçacıkları sadece KUTU İÇİNDE oluştur
            this.particles.push({
                x: this.box.x + 10 + Math.random() * (this.box.w - 20),
                y: this.box.y + 10 + Math.random() * (this.box.h - 20),
                vx: 0, vy: 0, 
                r: type === 'product' ? 8 : 5,
                type: type,
            });
        },

        updateSpeeds() {
            const speedBase = 1 + (this.temp / 20); 
            this.particles.forEach(p => {
                if(p.type === 'product') return; 
                const angle = Math.random() * Math.PI * 2;
                p.vx = Math.cos(angle) * speedBase;
                p.vy = Math.sin(angle) * speedBase;
            });
        },

        update() {
            if(!this.isRunning) return;

            const now = Date.now();
            this.elapsed = (now - this.startTime) / 1000;
            let productsFormed = 0;

            for(let i=0; i<this.particles.length; i++) {
                let p = this.particles[i];
                p.x += p.vx;
                p.y += p.vy;

                // KUTU DUVARLARIYLA ÇARPIŞMA
                if(p.x - p.r < this.box.x) { p.x = this.box.x + p.r; p.vx *= -1; }
                if(p.x + p.r > this.box.x + this.box.w) { p.x = this.box.x + this.box.w - p.r; p.vx *= -1; }
                if(p.y - p.r < this.box.y) { p.y = this.box.y + p.r; p.vy *= -1; }
                if(p.y + p.r > this.box.y + this.box.h) { p.y = this.box.y + this.box.h - p.r; p.vy *= -1; }

                if(p.type === 'product') productsFormed++;
            }

            // Parçacık Çarpışmaları (Reaction Logic)
            for(let i=0; i<this.particles.length; i++) {
                for(let j=i+1; j<this.particles.length; j++) {
                    const p1 = this.particles[i];
                    const p2 = this.particles[j];

                    if(p1.type === 'product' || p2.type === 'product') continue;

                    const dx = p1.x - p2.x;
                    const dy = p1.y - p2.y;
                    const dist = Math.sqrt(dx*dx + dy*dy);

                    if(dist < p1.r + p2.r) {
                        // A + B Çarpışması mı?
                        if(p1.type !== p2.type) {
                            const energy = (this.temp) + (Math.random() * 50);
                            
                            if(energy > this.activationEnergy) {
                                // TEPKİME BAŞARILI
                                p1.type = 'product';
                                p1.r = 9;
                                p1.vx *= 0.5; p1.vy *= 0.5;
                                p2.x = -9999; p2.type = 'removed'; 
                            } else {
                                // ESNEK ÇARPIŞMA (Tepkime yok)
                                this.resolveCollision(p1, p2);
                            }
                        } else {
                             // Aynı tür çarpışması (A+A veya B+B) -> Sadece esnek çarpışma
                             this.resolveCollision(p1, p2);
                        }
                    }
                }
            }

            // UI Güncelleme
            // Sınırlayıcı bileşene göre maks ürün sayısı
            const maxPossibleProducts = Math.min(this.countA, this.countB);
            const progress = maxPossibleProducts > 0 ? (productsFormed / maxPossibleProducts) * 100 : 0;
            const rate = this.elapsed > 0 ? (productsFormed / this.elapsed) : 0;
            
            this.updateUI(progress, rate, productsFormed);
        },
        
        resolveCollision(p1, p2) {
             const dx = p2.x - p1.x;
             const dy = p2.y - p1.y;
             const distance = Math.sqrt(dx*dx + dy*dy);
             const nx = dx / distance;
             const ny = dy / distance;
             const tx = -ny;
             const ty = nx;
             const dpTan1 = p1.vx * tx + p1.vy * ty;
             const dpTan2 = p2.vx * tx + p2.vy * ty;
             const dpNorm1 = p1.vx * nx + p1.vy * ny;
             const dpNorm2 = p2.vx * nx + p2.vy * ny;
             const m1 = 1; const m2 = 1; // Kütleler eşit varsayalım
             const mom1 = (dpNorm1 * (m1 - m2) + 2 * m2 * dpNorm2) / (m1 + m2);
             const mom2 = (dpNorm2 * (m2 - m1) + 2 * m1 * dpNorm1) / (m1 + m2);
             p1.vx = tx * dpTan1 + nx * mom1;
             p1.vy = ty * dpTan1 + ny * mom1;
             p2.vx = tx * dpTan2 + nx * mom2;
             p2.vy = ty * dpTan2 + ny * mom2;
             
             // Yapışmayı önle
             const overlap = (p1.r + p2.r - distance) / 2;
             p1.x -= overlap * nx; p1.y -= overlap * ny;
             p2.x += overlap * nx; p2.y += overlap * ny;
        },

        updateUI(progress, rate, count) {
            document.getElementById('valTime').innerText = this.elapsed.toFixed(1) + " s";
            document.getElementById('valProductCount').innerText = count;
            document.getElementById('barProgress').style.width = progress + "%";
            document.getElementById('valRate').innerText = (rate * 0.05).toFixed(3) + " M/s";
        },

        draw() {
            const ctx = this.ctx;
            ctx.clearRect(0, 0, this.width, this.height);
            
            // --- KUTU ÇİZİMİ (Tepkime Haznesi) ---
            const { x, y, w, h } = this.box;
            
            // Kutu Arkaplanı (Hafif Cam Efekti)
            ctx.fillStyle = "rgba(255, 255, 255, 0.4)";
            ctx.fillRect(x, y, w, h);
            
            // Kutu Kenarları
            ctx.lineWidth = 4;
            ctx.strokeStyle = "#cbd5e1";
            ctx.strokeRect(x, y, w, h);
            
            // Köşe Vidaları (Dekoratif)
            ctx.fillStyle = "#94a3b8";
            const screwR = 4;
            ctx.beginPath(); ctx.arc(x+10, y+10, screwR, 0, Math.PI*2); ctx.fill();
            ctx.beginPath(); ctx.arc(x+w-10, y+10, screwR, 0, Math.PI*2); ctx.fill();
            ctx.beginPath(); ctx.arc(x+10, y+h-10, screwR, 0, Math.PI*2); ctx.fill();
            ctx.beginPath(); ctx.arc(x+w-10, y+h-10, screwR, 0, Math.PI*2); ctx.fill();

            // Etiket
            ctx.fillStyle = "#cbd5e1";
            ctx.font = "bold 12px Inter";
            ctx.textAlign = "center";
            ctx.fillText("TEPKİME HAZNESİ", x + w/2, y - 10);

            // --- PARÇACIKLAR ---
            this.particles.forEach(p => {
                if(p.type === 'removed') return;

                ctx.beginPath();
                ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
                
                if(p.type === 'A') {
                    ctx.fillStyle = "#3b82f6"; // Mavi
                } else if (p.type === 'B') {
                    ctx.fillStyle = "#ef4444"; // Kırmızı
                } else {
                    ctx.fillStyle = "#f97316"; // Ürün (Turuncu)
                    ctx.shadowBlur = 10; ctx.shadowColor = "#f97316";
                }
                
                ctx.fill();
                ctx.shadowBlur = 0;
            });
        },

        loop() {
            this.update();
            this.draw();
            requestAnimationFrame(() => this.loop());
        }
    };

    app.init();
</script>
</body>
</html>
