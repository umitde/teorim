<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dalga Mekaniği | Teorim</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --bg-app: #f8fafc;
            --bg-panel: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --col-accent: #f97316;
            --border: #e2e8f0;
            --radius: 16px;
        }

        body { 
            margin: 0; padding: 0; background: var(--bg-app); 
            color: var(--text-main); font-family: 'Inter', sans-serif; 
            height: 100vh; display: flex; overflow: hidden; 
        }

        aside { 
            width: 320px; flex-shrink: 0; background: var(--bg-panel); 
            border-right: 1px solid var(--border); padding: 24px; 
            display: flex; flex-direction: column; gap: 20px; 
            z-index: 20; box-shadow: 4px 0 20px rgba(0,0,0,0.03);
            overflow-y: auto;
        }

        .section-title {
            font-size: 0.7rem; font-weight: 800; color: var(--text-muted);
            text-transform: uppercase; letter-spacing: 1px;
            margin-bottom: 8px; border-bottom: 1px solid var(--border); padding-bottom: 4px;
        }

        .control-group { background: #f8fafc; padding: 16px; border-radius: var(--radius); border: 1px solid var(--border); }
        .prop-row { display: flex; flex-direction: column; gap: 4px; margin-bottom: 15px; font-size: 0.8rem; font-weight: 700; }
        .label-val { display: flex; justify-content: space-between; align-items: center; }
        
        input[type="range"] { width: 100%; accent-color: var(--col-accent); cursor: pointer; margin-top: 5px; }

        .type-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 15px; }
        .type-btn {
            background: #fff; border: 1px solid var(--border); padding: 10px;
            border-radius: 12px; cursor: pointer; font-size: 0.7rem; font-weight: 800;
            transition: all 0.2s; text-align: center;
        }
        .type-btn.active { background: var(--col-accent); color: white; border-color: var(--col-accent); }

        main { flex: 1; position: relative; background: #ffffff; overflow: hidden; }
        canvas { display: block; width: 100%; height: 100%; }

        .data-card {
            position: absolute; top: 20px; right: 20px;
            background: rgba(255,255,255,0.9); padding: 15px;
            border-radius: var(--radius); border: 1px solid var(--border);
            min-width: 200px; backdrop-filter: blur(5px);
        }
    </style>
</head>
<body>

<aside>
    <div class="flex items-center gap-3 mb-4">
        <a href="../../dersler/fizik.html" class="p-2 hover:bg-orange-100 rounded-full text-orange-600 transition">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg>
        </a>
        <h1 class="font-bold text-xl text-slate-800">Dalga</h1>
    </div>

    <div class="section-title">Dalga Formu</div>
    <div class="type-grid">
        <button class="type-btn active" onclick="sim.setType('sine')">SİNÜS</button>
        <button class="type-btn" onclick="sim.setType('square')">KARE</button>
        <button class="type-btn" onclick="sim.setType('triangle')">ÜÇGEN</button>
        <button class="type-btn" onclick="sim.setType('sawtooth')">TESTERE</button>
    </div>

    <div class="section-title">Parametreler</div>
    <div class="control-group">
        <div class="prop-row">
            <div class="label-val"><span>Genlik (A):</span><span id="valAmp" class="text-orange-600">60 cm</span></div>
            <input type="range" id="slAmp" min="10" max="150" value="60">
        </div>
        <div class="prop-row">
            <div class="label-val"><span>Frekans (f):</span><span id="valFreq" class="text-orange-600">0.50 Hz</span></div>
            <input type="range" id="slFreq" min="0.1" max="2.0" step="0.1" value="0.5">
        </div>
        <div class="prop-row">
            <div class="label-val"><span>Dalga Boyu (λ):</span><span id="valLen" class="text-orange-600">200 cm</span></div>
            <input type="range" id="slLen" min="50" max="500" value="200">
        </div>
    </div>

    <div class="section-title">Görünüm</div>
    <div class="flex items-center gap-3 p-3 bg-slate-50 rounded-xl border border-slate-200">
        <input type="checkbox" id="chkParticles" checked onchange="sim.showParticles = this.checked">
        <label for="chkParticles" class="text-xs font-bold text-slate-600">Parçacık Dinamiği</label>
    </div>

    <button class="w-full py-3 mt-auto bg-slate-800 text-white rounded-xl font-bold text-xs hover:bg-slate-700 transition" onclick="sim.reset()">SİMÜLASYONU SIFIRLA</button>
</aside>

<main id="container">
    <div class="data-card">
        <div class="text-[10px] font-extrabold text-slate-400 uppercase mb-2">Fiziksel Veriler</div>
        <div class="flex justify-between text-xs mb-2"><span>Yayılma Hızı (v):</span><span id="txtV" class="font-mono font-bold text-orange-600">0 m/s</span></div>
        <div class="flex justify-between text-xs mb-2"><span>Periyot (T):</span><span id="txtT" class="font-mono font-bold text-orange-600">0 s</span></div>
        <div class="flex justify-between text-xs"><span>Açısal Hız (ω):</span><span id="txtW" class="font-mono font-bold text-orange-600">0 rad/s</span></div>
    </div>
    <canvas id="simCanvas"></canvas>
</main>

<script>
const sim = {
    canvas: document.getElementById('simCanvas'),
    ctx: null,
    width: 0, height: 0,
    time: 0,
    type: 'sine',
    amplitude: 60,
    frequency: 0.5,
    wavelength: 200,
    showParticles: true,
    lastTime: 0,

    init() {
        this.ctx = this.canvas.getContext('2d');
        this.resize();
        window.addEventListener('resize', () => this.resize());
        this.setupUI();
        this.loop(0);
    },

    resize() {
        const el = document.getElementById('container');
        this.width = this.canvas.width = el.clientWidth;
        this.height = this.canvas.height = el.clientHeight;
    },

    setupUI() {
        document.getElementById('slAmp').oninput = (e) => {
            this.amplitude = parseFloat(e.target.value);
            document.getElementById('valAmp').innerText = this.amplitude + " cm";
        };
        document.getElementById('slFreq').oninput = (e) => {
            this.frequency = parseFloat(e.target.value);
            document.getElementById('valFreq').innerText = this.frequency.toFixed(2) + " Hz";
        };
        document.getElementById('slLen').oninput = (e) => {
            this.wavelength = parseFloat(e.target.value);
            document.getElementById('valLen').innerText = this.wavelength + " cm";
        };
    },

    setType(t) {
        this.type = t;
        document.querySelectorAll('.type-btn').forEach(btn => {
            btn.classList.toggle('active', btn.innerText.toLowerCase() === t || (t === 'sine' && btn.innerText === 'SİNÜS'));
        });
    },

    reset() { this.time = 0; },

getWaveY(x, t) {
        // Matematiksel model: y(x,t) = A * sin(2π * (x/λ - f*t))
        const phase = (x / this.wavelength) - (this.frequency * t);
        const angle = 2 * Math.PI * phase;
        let y = 0;

        if (this.type === 'sine') {
            y = Math.sin(angle);
        } else if (this.type === 'square') {
            y = Math.sign(Math.sin(angle));
        } else if (this.type === 'triangle') {
            y = (2 / Math.PI) * Math.asin(Math.sin(angle));
        } else if (this.type === 'sawtooth') {
            // TESTERE DÜZELTMESİ: Fazın ondalık kısmını alarak doğrusal eğim oluşturur
            const frac = phase - Math.floor(phase);
            y = 2 * (frac - 0.5); 
        }

        return y * this.amplitude;
    },

    draw(dt) {
        const ctx = this.ctx;
        ctx.clearRect(0, 0, this.width, this.height);
        const centerY = this.height / 2;

        // Eksen
        ctx.strokeStyle = '#f1f5f9'; ctx.lineWidth = 2;
        ctx.beginPath(); ctx.moveTo(0, centerY); ctx.lineTo(this.width, centerY); ctx.stroke();

        // Dalga Çizgisi
        ctx.beginPath();
        ctx.lineWidth = 4;
        ctx.strokeStyle = '#f97316';
        ctx.lineJoin = 'round';
        
        for (let x = 0; x < this.width; x += 1) {
            const y = centerY + this.getWaveY(x, this.time);
            if (x === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
        }
        ctx.stroke();

        // Parçacıklar
        if (this.showParticles) {
            for (let x = 0; x < this.width; x += 50) {
                const y = centerY + this.getWaveY(x, this.time);
                ctx.fillStyle = '#1e293b';
                ctx.beginPath(); ctx.arc(x, y, 5, 0, 7); ctx.fill();
                // İz düşüm noktaları
                ctx.fillStyle = '#cbd5e1';
                ctx.beginPath(); ctx.arc(x, centerY, 2, 0, 7); ctx.fill();
            }
        }

        // Verileri Hesapla ve Yazdır
        const V = (this.frequency * this.wavelength).toFixed(1);
        const T = (1 / this.frequency).toFixed(2);
        const W = (2 * Math.PI * this.frequency).toFixed(2);

        document.getElementById('txtV').innerText = V + " cm/s";
        document.getElementById('txtT').innerText = T + " s";
        document.getElementById('txtW').innerText = W + " rad/s";

        // Zamanı akıcı bir hızda ilerlet (dt saniye cinsinden)
        this.time += dt; 
    },

    loop(now) {
        const dt = (now - this.lastTime) / 1000; // ms'den saniyeye çevir
        this.lastTime = now;
        
        // Hız kontrolü: Eğer çok büyük bir dt gelirse (sekme değişimi vb.) sınırlıyoruz
        this.draw(Math.min(dt, 0.1));
        requestAnimationFrame((t) => this.loop(t));
    }
};

sim.init();
</script>
</body>
</html>
