<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eğik Atış Simülasyonu | Teorim</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; overflow: hidden; }
        canvas { background: #f8fafc; cursor: crosshair; }
        .control-panel { backdrop-blur: md; background: rgba(255, 255, 255, 0.8); }
    </style>
</head>
<body class="bg-slate-100 flex h-screen">

    <div id="mobile-warning">
    <div class="mb-6">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-orange-500 animate-bounce" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" />
        </svg>
    </div>
    <h2 class="text-xl font-bold mb-2">En İyi Deneyim İçin</h2>
    <p class="text-slate-400">Lütfen cihazınızı yan çevirin veya bir tablet/bilgisayar kullanın.</p>
    </div>

    <div class="control-panel w-80 h-full border-r border-slate-200 p-6 flex flex-col gap-6 shadow-xl z-10">
        <div class="flex items-center gap-3 mb-4">
            <a href="../../dersler/fizik.html" class="p-2 hover:bg-orange-100 rounded-full text-orange-600 transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                </svg>
            </a>
            <h1 class="font-bold text-xl text-slate-800">Eğik Atış</h1>
        </div>

        <div class="space-y-4">
            <div>
                <label class="text-sm font-semibold text-slate-600 flex justify-between">
                    Atış Hızı <span id="vVal">50 m/s</span>
                </label>
                <input type="range" id="velocity" min="10" max="100" value="50" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-orange-500">
            </div>

            <div>
                <label class="text-sm font-semibold text-slate-600 flex justify-between">
                    Atış Açısı <span id="aVal">45°</span>
                </label>
                <input type="range" id="angle" min="0" max="90" value="45" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-orange-500">
            </div>

            <div>
                <label class="text-sm font-semibold text-slate-600 flex justify-between">
                    Yerçekimi <span id="gVal">9.8 m/s²</span>
                </label>
                <input type="range" id="gravity" min="1" max="20" step="0.1" value="9.8" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-orange-500">
            </div>
        </div>

        <button id="fireBtn" class="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-3 rounded-xl shadow-lg transition-all active:scale-95">
            ATEŞLE!
        </button>

        <button id="clearBtn" class="w-full border border-slate-300 hover:bg-slate-50 text-slate-600 font-semibold py-2 rounded-xl transition">
            Temizle
        </button>

        <div class="mt-auto p-4 bg-slate-800 rounded-2xl text-white text-xs space-y-2">
            <p>Menzil: <span id="rangeRes" class="text-orange-400 font-mono">0.00 m</span></p>
            <p>Max Yükseklik: <span id="heightRes" class="text-orange-400 font-mono">0.00 m</span></p>
            <p>Uçuş Süresi: <span id="timeRes" class="text-orange-400 font-mono">0.00 s</span></p>
        </div>
    </div>

    <canvas id="simCanvas" class="flex-1"></canvas>

<script>
    const canvas = document.getElementById('simCanvas');
    const ctx = canvas.getContext('2d');
    const vInput = document.getElementById('velocity');
    const aInput = document.getElementById('angle');
    const gInput = document.getElementById('gravity');

    let cameraScale = 1;
    let projectiles = [];
    const GROUND_Y = 80; 
    const START_X = 50;  
    const M_TO_PX = 20;  

    function resize() {
        canvas.width = window.innerWidth - 320;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    // UI Değerlerini güncelleme fonksiyonu
    function updateUI() {
        document.getElementById('vVal').innerText = vInput.value + " m/s";
        document.getElementById('aVal').innerText = aInput.value + "°";
        document.getElementById('gVal').innerText = gInput.value + " m/s²";
    }

    function fire() {
        const v0 = parseFloat(vInput.value);
        const angleDeg = parseFloat(aInput.value);
        const g = parseFloat(gInput.value);
        const angleRad = (angleDeg * Math.PI) / 180;

        projectiles.push({
            v0: v0,
            angleRad: angleRad,
            g: g,
            t: 0,
            path: [],
            color: `hsl(${Math.random() * 360}, 70%, 55%)`,
            radius: 8,
            landed: false,
            x: START_X,
            y: canvas.height - GROUND_Y
        });
        
        // Teorik Sonuçlar
        const range = (v0 * v0 * Math.sin(2 * angleRad)) / g;
        const maxHeight = (v0 * v0 * Math.pow(Math.sin(angleRad), 2)) / (2 * g);
        const flightTime = (2 * v0 * Math.sin(angleRad)) / g;

        document.getElementById('rangeRes').innerText = range.toFixed(2) + " m";
        document.getElementById('heightRes').innerText = maxHeight.toFixed(2) + " m";
        document.getElementById('timeRes').innerText = flightTime.toFixed(2) + " s";
    }

    function update() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Kamera Takibi
        let furthestX = canvas.width / cameraScale;
        projectiles.forEach(p => {
            if (!p.landed && p.x > furthestX - 100) furthestX = p.x + 100;
        });
        let targetScale = Math.min(canvas.width / (furthestX * 1.05), 1);
        cameraScale += (targetScale - cameraScale) * 0.05;
        cameraScale = Math.max(cameraScale, 0.1);

        ctx.save();
        ctx.translate(0, canvas.height - GROUND_Y);
        ctx.scale(cameraScale, cameraScale);
        ctx.translate(0, -(canvas.height - GROUND_Y));

        // --- OPTİMİZE EDİLMİŞ CETVEL ---
        const worldEnd = 10000; 
        ctx.beginPath();
        ctx.moveTo(START_X, canvas.height - GROUND_Y);
        ctx.lineTo(worldEnd * M_TO_PX, canvas.height - GROUND_Y);
        ctx.strokeStyle = "#94a3b8";
        ctx.lineWidth = 2 / cameraScale;
        ctx.stroke();

        // Sadece ekranda görünen metrajları çiz
        let startMeter = Math.floor(Math.max(0, (-START_X) / M_TO_PX));
        let endMeter = startMeter + Math.ceil((canvas.width / cameraScale) / M_TO_PX) + 100;

        for (let m = 0; m <= endMeter; m += 10) {
            let cx = START_X + (m * M_TO_PX);
            let isMajor = m % 50 === 0;
            ctx.beginPath();
            ctx.moveTo(cx, canvas.height - GROUND_Y);
            ctx.lineTo(cx, (canvas.height - GROUND_Y) + (isMajor ? 20 : 10) / cameraScale);
            ctx.strokeStyle = isMajor ? "#475569" : "#cbd5e1";
            ctx.lineWidth = (isMajor ? 2 : 1) / cameraScale;
            ctx.stroke();

            if (isMajor) {
                ctx.fillStyle = "#475569";
                ctx.font = `${14 / cameraScale}px Inter`;
                ctx.textAlign = "center";
                ctx.fillText(m + "m", cx, (canvas.height - GROUND_Y) + (40 / cameraScale));
            }
        }

        // --- HAREKET ---
        const dt = 0.02; // Zaman adımı

        projectiles.forEach((p) => {
            if (!p.landed) {
                p.t += dt;
                // Formül
                p.x = START_X + (p.v0 * Math.cos(p.angleRad) * p.t) * M_TO_PX;
                let height = (p.v0 * Math.sin(p.angleRad) * p.t) - (0.5 * p.g * p.t * p.t);
                p.y = (canvas.height - GROUND_Y) - (height * M_TO_PX);

                p.path.push({x: p.x, y: p.y});

                if (p.y >= canvas.height - GROUND_Y) {
                    p.y = canvas.height - GROUND_Y;
                    p.landed = true;
                }
            }

            // Yörünge
            ctx.beginPath();
            ctx.setLineDash([5/cameraScale, 5/cameraScale]);
            p.path.forEach((pos, i) => {
                if (i === 0) ctx.moveTo(pos.x, pos.y);
                else ctx.lineTo(pos.x, pos.y);
            });
            ctx.strokeStyle = p.color;
            ctx.lineWidth = 2 / cameraScale;
            ctx.stroke();
            ctx.setLineDash([]);

            // Top
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.radius / cameraScale, 0, Math.PI * 2);
            ctx.fillStyle = p.color;
            ctx.fill();
        });

        ctx.restore();
        requestAnimationFrame(update);
    }

    /* Mobil Uyarı Katmanı Stili */
#mobile-warning {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: #1e293b; /* Slate-800 */
    color: white;
    z-index: 9999;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 20px;
}

/* Sadece dikey mobil ekranlarda göster */
@media (max-width: 768px) and (orientation: portrait) {
    #mobile-warning {
        display: flex;
    }
    body {
        overflow: hidden;
    }
    }

    // Event Listeners (Döngünün dışında)
    document.getElementById('fireBtn').onclick = fire;
    document.getElementById('clearBtn').onclick = () => { 
        projectiles = []; 
        cameraScale = 1; 
    };
    vInput.oninput = updateUI;
    aInput.oninput = updateUI;
    gInput.oninput = updateUI;

    updateUI();
    update();
</script>
</body>
</html>
