<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galton Kutusu | Teorim</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@500;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-app: #f8fafc;
            --bg-panel: #ffffff;
            --text-main: #0f172a;
            --text-muted: #64748b;
            --col-accent: #f97316; /* Teorim Turuncu */
            --border: #e2e8f0;
            --radius: 16px;
        }

        body { 
            margin: 0; padding: 0; background: var(--bg-app); 
            color: var(--text-main); font-family: 'Inter', sans-serif; 
            height: 100vh; display: flex; overflow: hidden; 
            -webkit-font-smoothing: antialiased;
        }

        #mobile-warning { 
            display: none; position: fixed; inset: 0; background: #0f172a; color: white; 
            z-index: 9999; flex-direction: column; align-items: center; justify-content: center; 
            text-align: center; padding: 24px; 
        }
        @media (max-width: 768px) or (orientation: portrait) { #mobile-warning { display: flex; } }

        @keyframes phoneBounce {
            0%, 100% { transform: translateY(0) rotate(-5deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }
        .phone-icon { animation: phoneBounce 1.5s infinite ease-in-out; }

        aside { 
            width: 360px; flex-shrink: 0; background: var(--bg-panel); 
            border-right: 1px solid var(--border); padding: 24px; 
            display: flex; flex-direction: column; gap: 20px; 
            z-index: 20; box-shadow: 4px 0 24px rgba(0,0,0,0.04);
            overflow-y: auto;
        }

        .header { display: flex; align-items: center; gap: 14px; margin-bottom: 4px; }
        .back-btn {
            width: 44px; height: 44px; border-radius: 50%; background: #fff7ed; color: var(--col-accent);
            display: flex; align-items: center; justify-content: center; transition: 0.2s; cursor: pointer;
            border: 1px solid #ffedd5;
        }
        .back-btn:hover { background: #ffedd5; transform: translateX(-2px); }

        .section-title {
            font-size: 0.7rem; font-weight: 800; color: var(--text-muted);
            text-transform: uppercase; letter-spacing: 1px;
            margin-bottom: 8px; border-bottom: 1px solid var(--border); padding-bottom: 4px;
        }

        .control-group { background: #f8fafc; padding: 16px; border-radius: var(--radius); border: 1px solid var(--border); }
        .prop-row { display: flex; flex-direction: column; gap: 4px; margin-bottom: 8px; font-size: 0.8rem; font-weight: 700; }
        .label-val { display: flex; justify-content: space-between; align-items: center; }
        .val-badge { font-family: 'JetBrains Mono'; font-weight: 800; color: white; font-size: 0.85rem; padding: 4px 10px; border-radius: 8px; background: var(--col-accent); box-shadow: 0 2px 5px rgba(249, 115, 22, 0.3); }
        
        input[type="range"] { width: 100%; height: 6px; background: #e2e8f0; border-radius: 4px; appearance: none; cursor: pointer; margin-top: 12px; }
        input[type=range]::-webkit-slider-thumb { appearance: none; width: 22px; height: 22px; background: white; border: 4px solid var(--col-accent); border-radius: 50%; box-shadow: 0 2px 5px rgba(0,0,0,0.1); transition: 0.1s; }
        input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.15); }

        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 5px; }
        .ctrl-btn {
            width: 100%; padding: 14px 10px; background: var(--col-accent); color: white; font-weight: 800; 
            border-radius: 12px; border: none; cursor: pointer; transition: 0.2s; box-shadow: 0 4px 12px rgba(249,115,22,0.25);
            font-size: 0.75rem; letter-spacing: 0.5px; display: flex; justify-content: center; gap: 6px; align-items: center;
        }
        .ctrl-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(249,115,22,0.35); }
        .ctrl-btn-outline {
            background: #ffffff; color: var(--text-main); border: 1px solid var(--border);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .ctrl-btn-outline:hover { background: #f8fafc; border-color: #cbd5e1; transform: translateY(-2px); }

        main { flex: 1; position: relative; background: #ffffff; overflow: hidden; }
        main::before {
            content: ''; position: absolute; inset: 0;
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
            background-size: 40px 40px; opacity: 0.4; pointer-events: none;
        }
        canvas { display: block; width: 100%; height: 100%; position: absolute; z-index: 10; }

        .data-card {
            position: absolute; top: 24px; right: 24px; z-index: 20;
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(12px);
            padding: 20px 24px; border-radius: var(--radius); border: 1px solid var(--border);
            min-width: 250px; box-shadow: 0 10px 30px -5px rgba(0,0,0,0.05); pointer-events: none;
        }
    </style>
</head>
<body>

<div id="mobile-warning">
    <div class="phone-icon mb-6">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-20 w-20 text-orange-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" />
        </svg>
    </div>
    <h2 class="text-2xl font-bold mb-2">Yatay Konuma Geçin</h2>
    <p class="text-slate-400 text-sm max-w-xs">Galton Kutusu simülasyonunu tam görebilmek için cihazınızı yan çevirin.</p>
</div>

<aside>
    <div class="flex items-center gap-3 mb-2">
        <a href="../../dersler/matematik.html" class="p-2 hover:bg-orange-100 rounded-full text-orange-600 transition">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg>
        </a>
        <h1 class="font-bold text-xl text-slate-800">Galton Kutusu</h1>
    </div>

    <div class="bg-slate-800 text-white p-6 rounded-2xl text-center shadow-lg relative overflow-hidden">
        <div class="absolute top-0 right-0 w-32 h-32 bg-orange-500 opacity-10 blur-3xl rounded-full"></div>
        <div class="text-slate-400 font-bold text-xs uppercase tracking-widest mb-2">Toplam Top Sayısı</div>
        <div class="font-mono text-5xl font-extrabold mb-1 tracking-tight" id="uiTotalBalls">0</div>
        <div class="text-emerald-400 font-medium text-xs mt-3 flex items-center justify-center gap-1 bg-emerald-400/10 py-1.5 px-3 rounded-full w-max mx-auto">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12 7a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0V8.414l-4.293 4.293a1 1 0 01-1.414 0L8 10.414l-4.293 4.293a1 1 0 01-1.414-1.414l5-5a1 1 0 011.414 0L11 10.586 14.586 7H12z" clip-rule="evenodd" /></svg>
            Normal Dağılım
        </div>
    </div>

    <div class="section-title mt-2">Fizik & Geometri</div>
    <div class="control-group">
        <div class="prop-row">
            <div class="label-val"><span>Çivi Satırı (Derinlik)</span><span id="uiRows" class="val-badge">10</span></div>
            <input type="range" id="slRows" min="5" max="15" value="10" oninput="sim.updateRows(this.value)">
        </div>
    </div>
    
    <div class="btn-grid">
        <button class="ctrl-btn" onclick="sim.dropBalls(1)">+1 TOP BIRAK</button>
        <button class="ctrl-btn" onclick="sim.dropBalls(50)">+50 TOP BIRAK</button>
        <button class="ctrl-btn ctrl-btn-outline" id="btnAuto" onclick="sim.toggleAutoDrop()" style="grid-column: 1 / -1;">
            ▶ OTO BIRAKMAYI BAŞLAT
        </button>
    </div>
    
    <button class="w-full py-3 mt-2 bg-slate-100 text-slate-500 rounded-xl font-bold text-xs hover:bg-slate-200 transition" onclick="sim.resetBoard()">SİSTEMİ SIFIRLA</button>

    <div class="mt-auto p-4 bg-orange-50 border border-orange-100 rounded-xl">
        <p class="text-[10px] font-extrabold text-orange-500 uppercase mb-1">Merkezi Limit Teoremi</p>
        <p class="text-[11px] text-slate-700 leading-relaxed">Toplar çivilere çarptıkça sağa veya sola düşme olasılıkları %50'dir. Çok sayıda top bırakıldığında, ortadaki haznelerde toplanma ihtimali en yüksektir ve bir <strong>Çan Eğrisi</strong> oluşturur.</p>
    </div>
</aside>

<main id="container">
    <div class="data-card">
        <div class="text-[10px] font-extrabold text-slate-400 uppercase mb-4 border-b border-slate-100 pb-2">İstatistik Paneli</div>
        <div class="flex justify-between items-center text-xs mb-3"><span>Aktif Düşen:</span><span id="hudActive" class="font-bold text-slate-800">0</span></div>
        <div class="flex justify-between items-center text-xs mb-3"><span>En Dolu Hazne:</span><span id="hudMax" class="font-bold text-indigo-500">0 Top</span></div>
        <div class="flex justify-between items-center text-xs mb-2"><span>Dağılım Tipi:</span><span class="font-bold text-emerald-500">Binom</span></div>
        <div class="mt-4 w-full bg-slate-100 h-1.5 rounded-full overflow-hidden">
            <div id="hudProgress" class="bg-indigo-500 h-full transition-all duration-300 w-0"></div>
        </div>
    </div>

    <canvas id="simCanvas"></canvas>
</main>

<script>
const sim = {
    canvas: document.getElementById('simCanvas'),
    ctx: null, w: 0, h: 0,
    
    rows: 10,
    balls: [],
    bins: [],
    animating: true,
    
    totalDropped: 0,
    maxBinCount: 0,
    autoDropActive: false,
    autoDropTimer: 0,

    cx: 0,
    startY: 0,
    pegSpacing: 0,
    pegRadius: 3,
    ballRadius: 4,

    init() {
        this.ctx = this.canvas.getContext('2d');
        window.addEventListener('resize', () => this.resize());
        this.resize();
        requestAnimationFrame(() => this.loop());
    },

    resize() {
        const el = document.getElementById('container');
        const dpr = window.devicePixelRatio || 1;
        this.w = el.clientWidth; 
        this.h = el.clientHeight;
        this.canvas.width = this.w * dpr; 
        this.canvas.height = this.h * dpr;
        this.ctx.scale(dpr, dpr);
        
        this.calculateGeometry();
    },

    calculateGeometry() {
        this.cx = this.w / 2;
        const maxWidth = this.w * 0.7;
        const maxHeight = this.h * 0.55; 
        
        this.pegSpacing = Math.min(maxWidth / this.rows, maxHeight / this.rows);
        this.startY = 60; 
        this.binWidth = this.pegSpacing * 0.85; // Barlar arasında hafif boşluk
    },

    updateRows(val) {
        this.rows = parseInt(val);
        document.getElementById('uiRows').innerText = this.rows;
        this.resetBoard();
    },

    resetBoard() {
        this.balls = [];
        this.bins = new Array(this.rows + 1).fill(0);
        this.totalDropped = 0;
        this.maxBinCount = 0;
        this.calculateGeometry();
        this.updateHUD();
    },

    dropBalls(count) {
        for(let i=0; i<count; i++) {
            let path = [];
            let targetBin = 0;
            for(let r=0; r<this.rows; r++) {
                let dir = Math.random() < 0.5 ? 0 : 1;
                path.push(dir);
                targetBin += dir;
            }

            let delay = Math.random() * count * 2;
            
            this.balls.push({
                row: 0,
                col: 0,
                path: path,
                targetBin: targetBin,
                progress: -delay,
                speed: 0.04 + (Math.random() * 0.02) // DAHA YAVAŞ
            });
        }
    },

    toggleAutoDrop() {
        this.autoDropActive = !this.autoDropActive;
        const btn = document.getElementById('btnAuto');
        if (this.autoDropActive) {
            btn.innerHTML = "⏸ OTO BIRAKMAYI DURDUR";
            btn.classList.remove('ctrl-btn-outline');
            btn.classList.add('bg-indigo-500', 'text-white', 'border-none');
        } else {
            btn.innerHTML = "▶ OTO BIRAKMAYI BAŞLAT";
            btn.className = "ctrl-btn ctrl-btn-outline"; 
        }
    },

    updateHUD() {
        document.getElementById('uiTotalBalls').innerText = this.totalDropped;
        document.getElementById('hudActive').innerText = this.balls.filter(b => b.progress >= 0).length;
        document.getElementById('hudMax').innerText = this.maxBinCount + " Top";
        
        if(this.totalDropped > 0) {
            document.getElementById('hudProgress').style.width = Math.min(100, (this.maxBinCount / (this.totalDropped / 2)) * 100) + '%';
        } else {
            document.getElementById('hudProgress').style.width = '0%';
        }
    },

    getPegPos(row, col) {
        const xOffset = (col - row / 2) * this.pegSpacing;
        return {
            x: this.cx + xOffset,
            y: this.startY + row * this.pegSpacing
        };
    },

    loop() {
        if (!this.animating) return;

        if (this.autoDropActive) {
            this.autoDropTimer++;
            if (this.autoDropTimer > 4) { // Hız ayarı dengelendi
                this.dropBalls(2);
                this.autoDropTimer = 0;
            }
        }

        this.ctx.clearRect(0, 0, this.w, this.h);

        const binStartY = this.startY + this.rows * this.pegSpacing + 40; // Yüzdeler için ekstra boşluk
        const maxBarHeight = this.h - binStartY - 20;
        
        // 1. Hazneleri Çiz (Gradient ve Yüzdeler)
        for(let b=0; b<=this.rows; b++) {
            const count = this.bins[b] || 0;
            const xOffset = (b - this.rows / 2) * this.pegSpacing;
            const bx = this.cx + xOffset;
            
            let barH = 0;
            if(this.maxBinCount > 0) {
                barH = (count / this.maxBinCount) * maxBarHeight;
            }
            
            if (barH > 0) {
                // Gradient Ayarı
                let gradient = this.ctx.createLinearGradient(0, binStartY + maxBarHeight, 0, binStartY + maxBarHeight - barH);
                gradient.addColorStop(0, "rgba(59, 130, 246, 0.1)"); // Alt kısım soluk mavi
                gradient.addColorStop(1, "rgba(99, 102, 241, 0.9)"); // Üst kısım parlak indigo

                this.ctx.fillStyle = gradient;
                this.ctx.beginPath();
                this.ctx.roundRect(bx - this.binWidth/2, binStartY + maxBarHeight - barH, this.binWidth, barH, [6, 6, 0, 0]);
                this.ctx.fill();
                
                // Tepe Parlaklığı (Glow Cap)
                this.ctx.fillStyle = "#818cf8";
                this.ctx.beginPath();
                this.ctx.roundRect(bx - this.binWidth/2, binStartY + maxBarHeight - barH, this.binWidth, 4, [6, 6, 0, 0]);
                this.ctx.fill();

                // Yüzdelik Oran Metni
                if (this.totalDropped > 0) {
                    let percent = ((count / this.totalDropped) * 100).toFixed(1);
                    // %0.0 yazmasın diye kontrol
                    if (percent > 0) {
                        this.ctx.fillStyle = "#64748b";
                        this.ctx.font = "bold 10px Inter";
                        this.ctx.textAlign = "center";
                        this.ctx.fillText(percent + "%", bx, binStartY + maxBarHeight - barH - 8);
                    }
                }
            }
        }

        // 2. Çivileri (Pegs) Çiz
        this.ctx.fillStyle = "#cbd5e1"; 
        for (let r = 0; r <= this.rows; r++) {
            for (let c = 0; c <= r; c++) {
                const pos = this.getPegPos(r, c);
                this.ctx.beginPath();
                this.ctx.arc(pos.x, pos.y, this.pegRadius, 0, Math.PI * 2);
                this.ctx.fill();
            }
        }

        // 3. Topları Güncelle ve Çiz
        this.ctx.fillStyle = "#f97316"; 
        this.ctx.shadowBlur = 6;
        this.ctx.shadowColor = "rgba(249, 115, 22, 0.4)";

        for (let i = this.balls.length - 1; i >= 0; i--) {
            let ball = this.balls[i];
            
            ball.progress += ball.speed;
            
            if (ball.progress < 0) continue; 

            if (ball.progress >= 1.0) {
                ball.progress -= 1.0;
                ball.col += ball.path[ball.row]; 
                ball.row++;
            }

            if (ball.row >= this.rows) {
                if(!this.bins[ball.targetBin]) this.bins[ball.targetBin] = 0;
                this.bins[ball.targetBin]++;
                this.totalDropped++;
                if(this.bins[ball.targetBin] > this.maxBinCount) this.maxBinCount = this.bins[ball.targetBin];
                
                this.balls.splice(i, 1); 
                continue;
            }

            const p1 = this.getPegPos(ball.row, ball.col);
            const dir = ball.path[ball.row];
            const p2 = this.getPegPos(ball.row + 1, ball.col + dir);

            const curX = p1.x + (p2.x - p1.x) * ball.progress;
            const arcY = Math.sin(ball.progress * Math.PI) * (this.pegSpacing * 0.3);
            const curY = p1.y + (p2.y - p1.y) * ball.progress - arcY;

            this.ctx.beginPath();
            this.ctx.arc(curX, curY - this.pegRadius, this.ballRadius, 0, Math.PI * 2);
            this.ctx.fill();
        }
        
        this.ctx.shadowBlur = 0;

        if(Math.random() < 0.1) this.updateHUD();

        requestAnimationFrame(() => this.loop());
    }
};

window.addEventListener('load', () => sim.init());
</script>
</body>
</html>
