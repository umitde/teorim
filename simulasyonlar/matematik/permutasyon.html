<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Permütasyon & Kombinasyon | Teorim</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=JetBrains+Mono:wght@700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-app: #fdfdfd;
            --accent: #fb923c;
            --accent-soft: #fff7ed;
            --text-dark: #1e293b;
            --border: #f1f5f9;
        }

        body { 
            margin: 0; padding: 0; background: var(--bg-app); 
            color: var(--text-dark); font-family: 'Inter', sans-serif; 
            height: 100vh; display: flex; overflow: hidden; 
        }

        /* --- MOBİL UYARI (TAM STANDART) --- */
        #mobile-warning { 
            display: none; position: fixed; inset: 0; background: #0f172a; color: white; 
            z-index: 9999; flex-direction: column; align-items: center; justify-content: center; 
            text-align: center; padding: 24px; 
        }
        @media (max-width: 768px) or (orientation: portrait) { #mobile-warning { display: flex; } }

        @keyframes phoneBounce { 0%, 100% { transform: translateY(0) rotate(-5deg); } 50% { transform: translateY(-20px) rotate(5deg); } }
        .phone-icon { animation: phoneBounce 1.5s infinite ease-in-out; }

        /* --- SOL PANEL --- */
        aside { 
            width: 340px; flex-shrink: 0; background: white; 
            border-right: 2px solid var(--border); padding: 32px 24px; 
            display: flex; flex-direction: column; gap: 24px; 
            z-index: 20; overflow-y: auto;
        }

        .header { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
        .back-link {
            padding: 8px; border-radius: 9999px; transition: 0.2s; color: var(--accent);
            cursor: pointer; display: flex; align-items: center; justify-content: center;
        }
        .back-link:hover { background: var(--accent-soft); transform: translateX(-2px); }
        .logo-text { font-weight: 800; font-size: 1.4rem; color: var(--text-dark); letter-spacing: -0.5px; }

        /* Siyah Hesap Kartı (Panel İçi) */
        .math-card {
            background: #1e293b; color: white; padding: 24px; border-radius: 20px;
            text-align: center; box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            position: relative; overflow: hidden;
        }
        .math-card::after { content: ''; position: absolute; top: 0; right: 0; width: 80px; height: 80px; background: var(--accent); opacity: 0.1; filter: blur(30px); }
        .formula { font-family: 'JetBrains Mono'; color: #94a3b8; font-size: 0.85rem; margin-bottom: 6px; position: relative; z-index: 2; }
        .result-val { font-size: 2.8rem; font-weight: 800; color: var(--accent); line-height: 1; position: relative; z-index: 2; }

        .section-title { font-size: 11px; font-weight: 800; color: #cbd5e1; text-transform: uppercase; letter-spacing: 1.5px; }

        /* Mod Switcher */
        .mode-list { display: flex; flex-direction: column; gap: 6px; }
        .mode-item {
            padding: 14px 16px; border-radius: 12px; border: 1.5px solid var(--border);
            font-size: 13px; font-weight: 700; cursor: pointer; transition: 0.2s;
            display: flex; align-items: center; justify-content: space-between; color: #64748b;
        }
        .mode-item:hover { background: var(--accent-soft); border-color: var(--accent); }
        .mode-item.active { background: var(--accent); color: white; border-color: var(--accent); box-shadow: 0 4px 12px rgba(251, 146, 60, 0.2); }

        /* Parametreler */
        .input-card { background: #f8fafc; border-radius: 16px; padding: 16px; display: flex; flex-direction: column; gap: 10px; border: 1px solid var(--border); }
        input[type="range"] { width: 100%; -webkit-appearance: none; background: #e2e8f0; height: 6px; border-radius: 4px; outline: none; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 22px; height: 22px; background: white; border: 3px solid var(--accent); border-radius: 50%; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        .btn-group { display: flex; gap: 10px; margin-top: auto; }
        .action-btn { flex: 2; background: var(--accent); color: white; padding: 16px; border-radius: 16px; font-weight: 800; transition: 0.2s; box-shadow: 0 4px 15px rgba(251, 146, 60, 0.3); }
        .reset-btn { flex: 1; background: #f1f5f9; color: #64748b; padding: 16px; border-radius: 16px; font-weight: 700; transition: 0.2s; }
        .action-btn:hover { transform: translateY(-2px); filter: brightness(1.05); }
        .reset-btn:hover { background: #e2e8f0; }

        /* --- SİMÜLASYON ALANI --- */
        main { flex: 1; position: relative; background: #ffffff; display: flex; align-items: center; justify-content: center; }
        .dots { position: absolute; inset: 0; background-image: radial-gradient(#e2e8f0 1.2px, transparent 1.2px); background-size: 35px 35px; opacity: 0.6; pointer-events: none; }
        canvas { display: block; width: 100%; height: 100%; position: absolute; z-index: 10; }
    </style>
</head>
<body>

<div id="mobile-warning">
    <div class="phone-icon mb-6">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-20 w-20 text-orange-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" />
        </svg>
    </div>
    <h2 class="text-2xl font-bold mb-2 text-white">Lütfen Cihazı Yatay Tutun</h2>
    <p class="text-slate-400 text-sm max-w-xs">Simülasyonu görüntülemek için geniş bir ekrana ihtiyacınız var.</p>
</div>

<aside>
    <div class="header">
        <div class="back-link" onclick="window.history.back()">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg>
        </div>
        <div class="logo-text">Permütasyon</div>
    </div>

    <div class="math-card">
        <div class="formula" id="formulaDisp">P(5, 3)</div>
        <div class="result-val" id="resultVal">60</div>
    </div>

    <div class="flex flex-col gap-3">
        <div class="section-title">Hesap Türü</div>
        <div class="mode-list">
            <div id="btnP" class="mode-item active" onclick="sim.setMode('P')">Permütasyon <span>P</span></div>
            <div id="btnC" class="mode-item" onclick="sim.setMode('C')">Kombinasyon <span>C</span></div>
        </div>
    </div>

    <div class="flex flex-col gap-4">
        <div class="section-title">Parametreler</div>
        <div class="input-card">
            <div class="flex justify-between text-[11px] font-extrabold mb-1"><span>TOPLAM (N)</span><span id="lblN" class="text-orange-500">5</span></div>
            <input type="range" id="inpN" min="2" max="8" value="5" oninput="sim.updateParams()">
        </div>
        <div class="input-card">
            <div class="flex justify-between text-[11px] font-extrabold mb-1"><span>SEÇİM (R)</span><span id="lblR" class="text-orange-500">3</span></div>
            <input type="range" id="inpR" min="1" max="5" value="3" oninput="sim.updateParams()">
        </div>
    </div>

    <div class="btn-group">
        <button class="action-btn" onclick="sim.animate()">Örnekle</button>
        <button class="reset-btn" onclick="sim.reset()">Sıfırla</button>
    </div>
</aside>

<main id="main">
    <div class="dots"></div>
    <canvas id="canvas"></canvas>
</main>

<script>
const sim = {
    canvas: document.getElementById('canvas'),
    ctx: document.getElementById('canvas').getContext('2d'),
    mode: 'P', n: 5, r: 3, items: [], activeSample: [], isAnimating: false,
    colors: ['#fb923c', '#4f46e5', '#10b981', '#f43f5e', '#06b6d4', '#8b5cf6', '#eab308', '#64748b'],

    init() {
        window.addEventListener('resize', () => this.resize());
        this.resize();
        this.loop();
    },

    resize() {
        const main = document.getElementById('main');
        const dpr = window.devicePixelRatio || 1;
        this.w = main.clientWidth;
        this.h = main.clientHeight;
        this.canvas.width = this.w * dpr;
        this.canvas.height = this.h * dpr;
        this.ctx.scale(dpr, dpr);
        
        // Ekran boyutu değişince merkezlemeyi yeniden hesapla
        this.updateParams();
    },

    setMode(m) {
        this.mode = m;
        document.getElementById('btnP').classList.toggle('active', m === 'P');
        document.getElementById('btnC').classList.toggle('active', m === 'C');
        this.updateParams();
    },

    updateParams() {
        this.n = parseInt(document.getElementById('inpN').value);
        this.r = parseInt(document.getElementById('inpR').value);
        if(this.r > this.n) { this.r = this.n; document.getElementById('inpR').value = this.n; }
        
        document.getElementById('lblN').innerText = this.n;
        document.getElementById('lblR').innerText = this.r;
        
        const fact = (n) => n <= 1 ? 1 : n * fact(n-1);
        let res = (this.mode === 'P') 
            ? fact(this.n) / fact(this.n - this.r) 
            : fact(this.n) / (fact(this.r) * fact(this.n - this.r));
        
        document.getElementById('formulaDisp').innerText = `${this.mode}(${this.n}, ${this.r})`;
        document.getElementById('resultVal').innerText = res;
        
        this.initItems();
    },

    initItems() {
        this.items = [];
        const gap = 70;
        // Canvas her resize olduğunda startX yeniden hesaplanır
        const startX = (this.w - (this.n * gap)) / 2 + gap/2;
        for(let i=0; i<this.n; i++) {
            this.items.push({
                ox: startX + (i * gap), oy: 130, // Orijinal konumlar
                x: startX + (i * gap), y: 130,
                color: this.colors[i % this.colors.length], label: String.fromCharCode(65 + i), taken: false
            });
        }
        this.activeSample = [];
    },

    animate() {
        if(this.isAnimating) return;
        this.reset();
        this.isAnimating = true;
        
        // Rastgele seçim
        const pool = [...Array(this.n).keys()].sort(() => Math.random() - 0.5).slice(0, this.r);
        
        pool.forEach((idx, i) => {
            const source = this.items[idx];
            source.taken = true;
            let tx, ty;
            
            if(this.mode === 'P') {
                const gap = 90;
                tx = (this.w - (this.r * gap)) / 2 + gap/2 + (i * gap);
                ty = this.h - 180;
            } else {
                // Kombinasyon: Çarpışmayı önleyen dairesel dizilim
                const radius = 65;
                const angle = (Math.PI * 2 / this.r) * i - Math.PI/2;
                tx = (this.w / 2) + Math.cos(angle) * radius;
                ty = (this.h - 180) + Math.sin(angle) * radius;
            }

            this.activeSample.push({
                x: source.ox, y: source.oy, tx, ty, color: source.color, label: source.label, p: 0
            });
        });
        setTimeout(() => { this.isAnimating = false; }, 1200);
    },

    reset() {
        this.activeSample = [];
        this.items.forEach(i => i.taken = false);
        this.isAnimating = false;
    },

    loop() {
        this.ctx.clearRect(0, 0, this.w, this.h);
        
        // Üst Raf (Dinamik Genişlik)
        this.ctx.strokeStyle = '#f1f5f9'; this.ctx.lineWidth = 4; this.ctx.lineCap = "round";
        const shelfWidth = this.n * 70;
        this.ctx.beginPath(); 
        this.ctx.moveTo(this.w/2 - shelfWidth/2, 165); 
        this.ctx.lineTo(this.w/2 + shelfWidth/2, 165); 
        this.ctx.stroke();

        this.items.forEach(item => {
            this.drawBall(item.ox, item.oy, item.color, item.label, item.taken ? 0.15 : 1);
        });

        // Hedef Alanı Çerçevesi
        if(this.mode === 'C') {
            this.ctx.setLineDash([10, 6]); this.ctx.strokeStyle = '#e2e8f0'; this.ctx.lineWidth = 2;
            this.ctx.beginPath(); this.ctx.arc(this.w/2, this.h-180, 110, 0, 7); this.ctx.stroke();
            this.ctx.setLineDash([]);
            this.ctx.fillStyle = "#94a3b8"; this.ctx.font = "800 10px Inter"; this.ctx.textAlign = "center";
            this.ctx.fillText("SEÇİM HAVUZU", this.w/2, this.h-50);
        } else {
            const gap = 90;
            const sx = (this.w - (this.r * gap)) / 2 + gap/2;
            for(let i=0; i<this.r; i++) {
                this.ctx.strokeStyle = '#f1f5f9'; this.ctx.lineWidth = 2;
                this.ctx.strokeRect(sx + (i*gap) - 35, this.h-215, 70, 70);
                this.ctx.fillStyle = "#94a3b8"; this.ctx.font = "800 9px Inter"; this.ctx.textAlign = "center";
                this.ctx.fillText(`${i+1}. SIRA`, sx + (i*gap), this.h - 130);
            }
        }

        this.activeSample.forEach(s => {
            if(s.p < 1) s.p += 0.04;
            const ease = 1 - Math.pow(1 - s.p, 3); // Cubic ease out
            const cx = s.x + (s.tx - s.x) * ease;
            const cy = s.y + (s.ty - s.y) * ease;
            this.drawBall(cx, cy, s.color, s.label, 1, true);
        });

        requestAnimationFrame(() => this.loop());
    },

    drawBall(x, y, col, label, alpha, active = false) {
        this.ctx.globalAlpha = alpha;
        
        if(active) {
            this.ctx.shadowBlur = 15; this.ctx.shadowColor = 'rgba(0,0,0,0.1)';
        }

        this.ctx.fillStyle = col;
        this.ctx.beginPath(); this.ctx.arc(x, y, 26, 0, 7); this.ctx.fill();
        
        // Işık efekti
        this.ctx.fillStyle = 'rgba(255,255,255,0.2)';
        this.ctx.beginPath(); this.ctx.arc(x-8, y-8, 10, 0, 7); this.ctx.fill();

        this.ctx.fillStyle = 'white'; this.ctx.font = 'bold 18px Inter'; this.ctx.textAlign = 'center';
        this.ctx.fillText(label, x, y + 6);
        
        this.ctx.shadowBlur = 0;
        this.ctx.globalAlpha = 1;
    }
};

sim.init();
</script>
</body>
</html>
