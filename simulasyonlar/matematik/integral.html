<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>İntegral | Teorim</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@500;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-app: #f8fafc;
            --bg-panel: #ffffff;
            --text-main: #0f172a;
            --text-muted: #64748b;
            --col-accent: #f97316;
            --col-indigo: #4f46e5;
            --border: #e2e8f0;
            --radius: 16px;
        }

        body { 
            margin: 0; padding: 0; background: var(--bg-app); 
            color: var(--text-main); font-family: 'Inter', sans-serif; 
            height: 100vh; display: flex; overflow: hidden; 
            -webkit-font-smoothing: antialiased;
        }

        #mobile-warning { 
            display: none; position: fixed; inset: 0; background: #0f172a; color: white; 
            z-index: 9999; flex-direction: column; align-items: center; justify-content: center; 
            text-align: center; padding: 24px; 
        }
        @media (max-width: 768px) or (orientation: portrait) { #mobile-warning { display: flex; } }

        @keyframes phoneBounce { 0%, 100% { transform: translateY(0) rotate(-5deg); } 50% { transform: translateY(-20px) rotate(5deg); } }
        .phone-icon { animation: phoneBounce 1.5s infinite ease-in-out; }

        aside { 
            width: 360px; flex-shrink: 0; background: var(--bg-panel); 
            border-right: 1px solid var(--border); padding: 24px; 
            display: flex; flex-direction: column; gap: 20px; 
            z-index: 20; box-shadow: 4px 0 24px rgba(0,0,0,0.04);
            overflow-y: auto;
        }

        .header { display: flex; align-items: center; gap: 14px; margin-bottom: 4px; }
        .back-btn {
            width: 44px; height: 44px; border-radius: 50%; background: #fff7ed; color: var(--col-accent);
            display: flex; align-items: center; justify-content: center; transition: 0.2s; cursor: pointer; border: 1px solid #ffedd5;
        }
        .back-btn:hover { background: #ffedd5; transform: translateX(-2px); }

        .section-title { font-size: 0.7rem; font-weight: 800; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; border-bottom: 1px solid var(--border); padding-bottom: 4px; }

        .func-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 4px; }
        .func-btn {
            background: #f8fafc; border: 1px solid var(--border); color: var(--text-muted);
            padding: 12px; border-radius: 12px; cursor: pointer; font-family: 'JetBrains Mono'; font-size: 0.8rem; font-weight: 700;
            transition: all 0.2s; display: flex; align-items: center; justify-content: center;
        }
        .func-btn:hover { border-color: var(--col-indigo); color: var(--col-indigo); background: #ffffff; }
        .func-btn.active { background: var(--col-indigo); color: white; border-color: var(--col-indigo); box-shadow: 0 4px 12px rgba(79, 70, 229, 0.25); }

        .control-group { background: #f8fafc; padding: 16px; border-radius: var(--radius); border: 1px solid var(--border); }
        .prop-row { display: flex; flex-direction: column; gap: 4px; margin-bottom: 12px; font-size: 0.8rem; font-weight: 700; }
        .prop-row:last-child { margin-bottom: 0; }
        .label-val { display: flex; justify-content: space-between; align-items: center; }
        .val-badge { font-family: 'JetBrains Mono'; font-weight: 800; color: white; font-size: 0.85rem; padding: 4px 10px; border-radius: 8px; background: var(--col-accent); box-shadow: 0 2px 5px rgba(249, 115, 22, 0.3); }
        .val-badge.indigo { background: var(--col-indigo); box-shadow: 0 2px 5px rgba(79, 70, 229, 0.3); }
        
        input[type="range"] { width: 100%; height: 6px; background: #e2e8f0; border-radius: 4px; appearance: none; cursor: pointer; margin-top: 6px; }
        input[type=range]::-webkit-slider-thumb { appearance: none; width: 22px; height: 22px; background: white; border: 4px solid var(--col-accent); border-radius: 50%; box-shadow: 0 2px 5px rgba(0,0,0,0.1); transition: 0.1s; }
        input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.15); }
        #slN::-webkit-slider-thumb { border-color: var(--col-indigo); }

        main { flex: 1; position: relative; background: #ffffff; overflow: hidden; }
        .dot-bg { position: absolute; inset: 0; background-image: radial-gradient(#cbd5e1 1.5px, transparent 1.5px); background-size: 30px 30px; opacity: 0.3; z-index: 1; pointer-events: none; }
        canvas { display: block; width: 100%; height: 100%; position: absolute; z-index: 10; cursor: crosshair; }
    </style>
</head>
<body>

<div id="mobile-warning">
    <div class="phone-icon mb-6">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-20 w-20 text-orange-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" />
        </svg>
    </div>
    <h2 class="text-2xl font-bold mb-2">Yatay Konuma Geçin</h2>
    <p class="text-slate-400 text-sm max-w-xs">Matematik simülasyonunu tam görebilmek için cihazınızı yan çevirin.</p>
</div>

<aside>
    <div class="flex items-center gap-3 mb-2">
        <a href="../../dersler/matematik.html" class="p-2 hover:bg-orange-100 rounded-full text-orange-600 transition">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg>
        </a>
        <h1 class="font-bold text-xl text-slate-800">İntegral</h1>
    </div>

    <div class="bg-slate-800 text-white p-6 rounded-2xl text-center shadow-lg relative overflow-hidden">
        <div class="absolute top-0 right-0 w-32 h-32 bg-orange-500 opacity-10 blur-3xl rounded-full"></div>
        <div class="text-slate-400 font-bold text-xs uppercase tracking-widest mb-2">Riemann Toplamı</div>
        <div class="font-mono text-5xl font-extrabold mb-1 tracking-tight" id="uiArea">0.00</div>
        
        <div class="text-emerald-400 font-medium text-xs mt-3 flex items-center justify-center gap-1 bg-emerald-400/10 py-1.5 px-3 rounded-full w-max mx-auto" id="uiExact">
            Gerçek Değer: 0.00
        </div>
        
        <div class="flex justify-between items-center mt-5 pt-4 border-t border-slate-700 text-[11px] font-bold">
             <span class="text-slate-400">Mutlak Hata:</span>
             <span class="text-rose-400" id="uiError">0.00</span>
        </div>
    </div>

    <div class="section-title mt-2">Fonksiyon Seçimi</div>
    <div class="func-grid">
        <button class="func-btn active" onclick="sim.setFunc(0)">0.1x² + 1</button>
        <button class="func-btn" onclick="sim.setFunc(1)">sin(x) + 2</button>
        <button class="func-btn" onclick="sim.setFunc(2)">-0.1x³ + x + 2</button>
        <button class="func-btn" onclick="sim.setFunc(3)">√x</button>
    </div>

    <div class="section-title mt-2">Sınırlar ve Çözünürlük</div>
    <div class="control-group">
        <div class="prop-row">
            <div class="label-val"><span class="text-slate-600">Alt Sınır (a)</span><span id="uiValA" class="val-badge">-1</span></div>
            <input type="range" id="slA" min="-4" max="8" step="0.5" value="-1" oninput="sim.updateParams()">
        </div>
        <div class="prop-row mt-3">
            <div class="label-val"><span class="text-slate-600">Üst Sınır (b)</span><span id="uiValB" class="val-badge">4</span></div>
            <input type="range" id="slB" min="-4" max="8" step="0.5" value="4" oninput="sim.updateParams()">
        </div>
        <div class="prop-row mt-3">
            <div class="label-val"><span class="text-slate-600">Dilim Sayısı (n)</span><span id="uiValN" class="val-badge indigo">6</span></div>
            <input type="range" id="slN" min="2" max="50" step="1" value="6" oninput="sim.updateParams()">
        </div>
    </div>

    <div class="mt-auto p-4 bg-orange-50 border border-orange-100 rounded-xl">
        <p class="text-[10px] font-extrabold text-orange-500 uppercase mb-1">Disk Yöntemi</p>
        <p class="text-[11px] text-slate-700 leading-relaxed">Riemann dikdörtgenleri sadece alanı değil, X ekseninde döndürüldüğünde oluşacak hacmi de (silindirleri) hesaplamamızı sağlar.</p>
    </div>
</aside>

<main id="container">
    <div class="dot-bg"></div>
    <canvas id="simCanvas"></canvas>
</main>

<script>
const sim = {
    canvas: document.getElementById('simCanvas'),
    ctx: null, w: 0, h: 0,
    
    funcId: 0, a: -1, b: 4, n: 6,
    scale: 60, offsetX: 0, offsetY: 0, time: 0,
    
    funcs: [
        { f: (x) => 0.1 * x * x + 1, F: (x) => (0.1 * x * x * x) / 3 + x },
        { f: (x) => Math.sin(x) + 2, F: (x) => -Math.cos(x) + 2 * x },
        { f: (x) => -0.1*Math.pow(x,3) + x + 2, F: (x) => -0.1*(Math.pow(x,4)/4) + (x*x)/2 + 2*x },
        { f: (x) => x < 0 ? 0 : Math.sqrt(x), F: (x) => x < 0 ? 0 : (2/3) * Math.pow(x, 1.5) }
    ],

    init() {
        this.ctx = this.canvas.getContext('2d');
        window.addEventListener('resize', () => this.resize());
        this.resize();
        this.setFunc(0);
        requestAnimationFrame(() => this.loop());
    },

    resize() {
        const el = document.getElementById('container');
        const dpr = window.devicePixelRatio || 1;
        this.w = el.clientWidth; this.h = el.clientHeight;
        this.canvas.width = this.w * dpr; this.canvas.height = this.h * dpr;
        this.ctx.scale(dpr, dpr);
        
        this.offsetX = this.w / 2 - 50;
        this.offsetY = this.h / 2 + 100;
    },

    setFunc(id) {
        this.funcId = id;
        document.querySelectorAll('.func-btn').forEach((b, i) => b.className = i === id ? 'func-btn active' : 'func-btn');
        this.updateParams();
    },

    updateParams() {
        let valA = parseFloat(document.getElementById('slA').value);
        let valB = parseFloat(document.getElementById('slB').value);
        let valN = parseInt(document.getElementById('slN').value);
        
        if(valB <= valA + 0.5) { 
            valB = valA + 0.5; 
            document.getElementById('slB').value = valB; 
        }
        
        this.a = valA; this.b = valB; this.n = valN;
        document.getElementById('uiValA').innerText = this.a;
        document.getElementById('uiValB').innerText = this.b;
        document.getElementById('uiValN').innerText = this.n;
        
        this.calculate();
    },

    calculate() {
        const func = this.funcs[this.funcId];
        const dx = (this.b - this.a) / this.n;
        let sum = 0;
        
        for(let i = 1; i <= this.n; i++) sum += func.f(this.a + i * dx) * dx;
        
        const exact = func.F(this.b) - func.F(this.a);
        document.getElementById('uiArea').innerText = sum.toFixed(3);
        document.getElementById('uiExact').innerText = `Gerçek Değer: ${exact.toFixed(3)}`;
        document.getElementById('uiError').innerText = Math.abs(sum - exact).toFixed(3);
    },

    toCx(x) { return this.offsetX + (x * this.scale); },
    toCy(y) { return this.offsetY - (y * this.scale); },

    loop() {
        this.ctx.clearRect(0, 0, this.w, this.h);
        
        this.drawAxes();
        this.drawIntegralArea();
        this.drawCurve();
        
        this.draw3DPanel();

        requestAnimationFrame(() => this.loop());
    },

    drawAxes() {
        const ctx = this.ctx;
        ctx.strokeStyle = "#94a3b8"; ctx.lineWidth = 2; ctx.beginPath();
        ctx.moveTo(0, this.offsetY); ctx.lineTo(this.w, this.offsetY);
        ctx.moveTo(this.offsetX, 0); ctx.lineTo(this.offsetX, this.h);
        ctx.stroke();

        ctx.fillStyle = "#64748b"; ctx.font = "bold 11px Inter"; ctx.textAlign="center"; ctx.textBaseline="top";
        for(let i = -15; i <= 15; i++) {
            if(i===0) continue;
            const px = this.toCx(i); const py = this.toCy(i);
            ctx.fillRect(px - 1, this.offsetY - 4, 2, 8);
            if(i%2===0) ctx.fillText(i, px, this.offsetY + 12);
            ctx.fillRect(this.offsetX - 4, py - 1, 8, 2);
            if(i%2===0) {
                ctx.textAlign="right"; ctx.textBaseline="middle";
                ctx.fillText(i, this.offsetX - 10, py);
                ctx.textAlign="center"; ctx.textBaseline="top";
            }
        }
    },

    drawCurve() {
        const ctx = this.ctx; const func = this.funcs[this.funcId];
        ctx.strokeStyle = "#4f46e5"; ctx.lineWidth = 4; ctx.lineJoin = "round"; ctx.beginPath();
        let first = true;
        for(let px = 0; px <= this.w; px+=2) {
            const x = (px - this.offsetX) / this.scale;
            const py = this.toCy(func.f(x));
            if(isNaN(py) || py < -100 || py > this.h+100) { first = true; continue; }
            if(first) { ctx.moveTo(px, py); first = false; } else { ctx.lineTo(px, py); }
        }
        ctx.stroke();
    },

    drawIntegralArea() {
        const ctx = this.ctx; const func = this.funcs[this.funcId];
        const dx = (this.b - this.a) / this.n;

        // Gerçek Alan Gölgesi
        ctx.fillStyle = "rgba(79, 70, 229, 0.08)"; ctx.beginPath();
        let hasStarted = false;
        for(let px = this.toCx(this.a); px <= this.toCx(this.b); px+=2) {
            const x = (px - this.offsetX) / this.scale;
            if(!isNaN(func.f(x))) {
                const py = this.toCy(func.f(x));
                if(!hasStarted) { ctx.moveTo(px, this.toCy(0)); ctx.lineTo(px, py); hasStarted = true; } 
                else ctx.lineTo(px, py);
            }
        }
        if(hasStarted) { ctx.lineTo(this.toCx(this.b), this.toCy(0)); ctx.fill(); }

        // Riemann Dikdörtgenleri
        for(let i = 0; i < this.n; i++) {
            const xL = this.a + i * dx;
            const xR = this.a + (i+1) * dx;
            const h = func.f(xR);
            if(isNaN(h)) continue;

            const px = this.toCx(xL); const py = this.toCy(h);
            const pw = this.toCx(xR) - px; const ph = this.toCy(0) - py;

            ctx.fillStyle = "rgba(79, 70, 229, 0.15)"; ctx.fillRect(px, py, pw, ph);
            ctx.strokeStyle = "rgba(79, 70, 229, 0.6)"; ctx.lineWidth = 1.5;
            ctx.beginPath(); ctx.moveTo(px, this.toCy(0)); ctx.lineTo(px, py); ctx.lineTo(px + pw, py); ctx.lineTo(px + pw, this.toCy(0)); ctx.stroke();
        }

        // Sınır Çizgileri
        ctx.strokeStyle = "#f97316"; ctx.lineWidth = 2.5; ctx.setLineDash([5, 5]);
        const drawLimit = (xVal) => {
            if(isNaN(func.f(xVal))) return;
            ctx.beginPath(); ctx.moveTo(this.toCx(xVal), this.toCy(0)); ctx.lineTo(this.toCx(xVal), this.toCy(func.f(xVal))); ctx.stroke();
        };
        drawLimit(this.a); drawLimit(this.b);
        ctx.setLineDash([]);
    },

    // --- KUSURSUZ SABİT VE DİNAMİK 3D PANEL ---
    draw3DPanel() {
        const ctx = this.ctx;
        const panelW = 280, panelH = 200;
        const ix = this.w - panelW - 24;
        const iy = 24;
        const icx = ix + panelW / 2;
        const icy = iy + panelH / 2 + 15;

        // Kutu Çerçeve
        ctx.save();
        ctx.fillStyle = "rgba(255, 255, 255, 0.95)";
        ctx.shadowColor = "rgba(0,0,0,0.1)"; ctx.shadowBlur = 20;
        ctx.beginPath(); ctx.roundRect(ix, iy, panelW, panelH, 20);
        ctx.fill(); ctx.shadowBlur = 0; 
        ctx.strokeStyle = "#e2e8f0"; ctx.lineWidth = 1; ctx.stroke();
        ctx.clip(); 

        ctx.fillStyle = "#4f46e5"; ctx.font = "bold 10px Inter"; ctx.textAlign="left";
        ctx.fillText("HACİM (DİSK YÖNTEMİ)", ix + 20, iy + 25);

        const func = this.funcs[this.funcId];

        // 1. DİNAMİK ÖLÇEK (Sınırlara Asla Çarpmaz)
        let maxR = 0.001;
        for(let px = this.a; px <= this.b; px+=0.05) {
            let v = Math.abs(func.f(px));
            if(!isNaN(v) && v > maxR) maxR = v;
        }
        const rangeX = Math.max(this.b - this.a, 0.1);
        
        const availW = panelW - 60; // Yan boşluk
        const availH = panelH - 80; // Üst alt boşluk
        
        const sX = availW / rangeX;
        const sR = (availH / 2) / maxR;
        const tilt = 0.35; // Sabit Açı (Sallantı Yok)

        // Merkez Eksen
        ctx.strokeStyle = "#cbd5e1"; ctx.lineWidth = 1.5;
        ctx.beginPath(); ctx.moveTo(ix + 15, icy); ctx.lineTo(ix + panelW - 15, icy); ctx.stroke();

        // 2. CAM SİLUET (Fonksiyonun Genel Hacmi)
        ctx.beginPath();
        for(let px = this.a; px <= this.b; px+=0.05) {
            const v = func.f(px);
            if(!isNaN(v)) {
                const sx = icx + (px - (this.a+this.b)/2) * sX;
                const sy = icy - Math.abs(v) * sR;
                if(px === this.a) ctx.moveTo(sx, sy); else ctx.lineTo(sx, sy);
            }
        }
        for(let px = this.b; px >= this.a; px-=0.05) {
            const v = func.f(px);
            if(!isNaN(v)) {
                const sx = icx + (px - (this.a+this.b)/2) * sX;
                const sy = icy + Math.abs(v) * sR;
                ctx.lineTo(sx, sy);
            }
        }
        ctx.closePath();
        
        const grad = ctx.createLinearGradient(0, icy - maxR*sR, 0, icy + maxR*sR);
        grad.addColorStop(0, "rgba(99, 102, 241, 0.15)");
        grad.addColorStop(0.5, "rgba(99, 102, 241, 0.02)");
        grad.addColorStop(1, "rgba(99, 102, 241, 0.2)");
        ctx.fillStyle = grad; ctx.fill();
        ctx.strokeStyle = "rgba(79, 70, 229, 0.3)"; ctx.lineWidth = 1; ctx.stroke();

        // 3. 3D RİEMANN DİSKLERİ (Silindirler)
        const dx = (this.b - this.a) / this.n;
        for(let i = 0; i < this.n; i++) {
            const xL = this.a + i * dx;
            const xR = this.a + (i+1) * dx;
            const v = func.f(xR); // Sağ Uç
            if(isNaN(v) || Math.abs(v) < 0.01) continue;
            
            const r = Math.abs(v) * sR;
            const sxL = icx + (xL - (this.a+this.b)/2) * sX;
            const sxR = icx + (xR - (this.a+this.b)/2) * sX;
            
            // Silindir Gövdesi
            ctx.fillStyle = "rgba(79, 70, 229, 0.15)";
            ctx.beginPath();
            ctx.moveTo(sxL, icy - r); ctx.lineTo(sxR, icy - r);
            ctx.lineTo(sxR, icy + r); ctx.lineTo(sxL, icy + r);
            ctx.fill();
            
            // Arka Kapak (Sadece dış hat)
            ctx.strokeStyle = "rgba(79, 70, 229, 0.2)"; ctx.lineWidth = 1;
            ctx.beginPath(); ctx.ellipse(sxL, icy, r * tilt, r, 0, 0, Math.PI*2); ctx.stroke();
            
            // Ön Kapak (Dolgu + Kalın Çizgi)
            ctx.fillStyle = "rgba(79, 70, 229, 0.25)";
            ctx.strokeStyle = "rgba(79, 70, 229, 0.8)"; ctx.lineWidth = 1.5;
            ctx.beginPath(); ctx.ellipse(sxR, icy, r * tilt, r, 0, 0, Math.PI*2); 
            ctx.fill(); ctx.stroke();
        }

        ctx.restore();
    }
};

window.addEventListener('load', () => sim.init());
</script>
</body>
</html>
