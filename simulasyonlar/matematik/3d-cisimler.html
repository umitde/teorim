<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Cisimler Laboratuvarı | Teorim</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-app: #f8fafc;
            --bg-panel: #ffffff;
            --col-primary: #f97316; /* Turuncu */
            --col-sec: #3b82f6;    /* Mavi */
            --text-main: #334155;
            --text-muted: #94a3b8;
            --border: #e2e8f0;
            --radius: 20px;
        }

        body { 
            margin: 0; background: var(--bg-app); 
            font-family: 'Inter', sans-serif; 
            height: 100vh; display: flex; overflow: hidden; color: var(--text-main);
        }

        /* MOBİL UYARI */
        #mobile-warning { 
            display: none; position: fixed; inset: 0; 
            background: #0f172a; color: white; z-index: 9999; 
            flex-direction: column; align-items: center; justify-content: center; 
            text-align: center; padding: 20px; 
        }
        @media (max-width: 768px) or (orientation: portrait) { #mobile-warning { display: flex; } }
        .phone-icon { animation: phoneBounce 1.5s infinite ease-in-out; }
        @keyframes phoneBounce {
            0%, 100% { transform: translateY(0) rotate(-5deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        /* SOL PANEL */
        aside { 
            width: 360px; flex-shrink: 0; background: var(--bg-panel); 
            border-right: 1px solid var(--border); padding: 24px; 
            display: flex; flex-direction: column; gap: 24px; 
            z-index: 30; box-shadow: 10px 0 30px rgba(0,0,0,0.02);
            overflow-y: auto;
        }

        .section-header {
            font-size: 0.7rem; font-weight: 800; color: var(--text-muted);
            text-transform: uppercase; letter-spacing: 1.5px;
            margin-bottom: 12px; border-bottom: 1px solid var(--border); padding-bottom: 6px;
        }

        /* ŞEKİL SEÇİCİ */
        .shape-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .shape-btn {
            padding: 12px; border: 1px solid var(--border); background: #f8fafc;
            border-radius: 12px; cursor: pointer; font-weight: 600; color: var(--text-muted);
            transition: all 0.2s; font-size: 0.85rem; text-align: center;
            display: flex; flex-direction: column; align-items: center; gap: 5px;
        }
        .shape-btn:hover { background: #fff7ed; color: var(--col-primary); border-color: var(--col-primary); }
        .shape-btn.active { background: var(--col-primary); color: white; border-color: var(--col-primary); box-shadow: 0 4px 10px rgba(249, 115, 22, 0.3); }

        /* KONTROLLER */
        .control-group { background: #f8fafc; padding: 16px; border-radius: 12px; border: 1px solid var(--border); }
        .slider-label { display: flex; justify-content: space-between; font-size: 0.8rem; font-weight: 700; color: var(--text-main); margin-bottom: 8px; }
        input[type="range"] { 
            width: 100%; accent-color: var(--col-primary); cursor: pointer; height: 4px; border-radius: 2px; background: #e2e8f0; 
        }

        /* HESAPLAMA KARTI */
        .calc-card {
            background: #fff; border: 1px solid var(--border);
            border-radius: 12px; padding: 16px;
            display: flex; flex-direction: column; gap: 8px;
        }
        .calc-row { display: flex; justify-content: space-between; align-items: center; padding-bottom: 8px; border-bottom: 1px dashed var(--border); }
        .calc-row:last-child { border-bottom: none; padding-bottom: 0; }
        .calc-label { font-size: 0.8rem; font-weight: 600; color: var(--text-muted); }
        .calc-val { font-family: 'Menlo', monospace; font-size: 1.1rem; font-weight: 700; color: var(--text-main); }
        .calc-unit { font-size: 0.7rem; color: #cbd5e1; margin-left: 4px; }

        /* ANA ALAN */
        main { 
            flex: 1; display: flex; flex-direction: column; 
            padding: 24px; gap: 24px; background: #f8fafc;
            overflow: hidden;
        }

        .canvas-container {
            flex: 1; background: white; border-radius: var(--radius);
            border: 1px solid var(--border); box-shadow: 0 10px 30px -10px rgba(0,0,0,0.05);
            position: relative; overflow: hidden; cursor: grab;
        }
        .canvas-container:active { cursor: grabbing; }
        canvas { display: block; width: 100%; height: 100%; }

        /* FORMÜL KARTI (Floating) */
        .formula-card {
            position: absolute; top: 20px; right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 16px; border-radius: 12px;
            border: 1px solid var(--border);
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            backdrop-filter: blur(8px); pointer-events: none;
            min-width: 200px;
            transition: all 0.3s ease;
        }
        .formula-title {
            font-size: 0.7rem; font-weight: 800; color: #94a3b8; 
            text-transform: uppercase; margin-bottom: 8px; letter-spacing: 0.5px;
        }
        .formula-row {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;
        }
        .f-label { font-size: 0.8rem; font-weight: 600; color: var(--text-muted); }
        .f-math { font-family: 'Menlo', monospace; font-size: 0.9rem; font-weight: 700; color: var(--col-primary); }

    </style>
</head>
<body>

    <div id="mobile-warning">
        <div class="phone-icon mb-6">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-20 w-20 text-orange-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" />
            </svg>
        </div>
        <h2 class="text-2xl font-bold mb-2">Yatay Moda Geçin</h2>
        <p class="text-slate-400 text-sm max-w-xs">3D laboratuvarı için geniş ekran gereklidir.</p>
    </div>

<aside>
    <div class="flex items-center gap-3 mb-2">
        <a href="../../dersler/matematik.html" class="p-2 hover:bg-orange-50 rounded-full text-orange-600 transition">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
        </a>
        <h1 class="font-bold text-xl text-slate-800">3D Cisimler</h1>
    </div>

    <div class="section-header">Şekil Seçimi</div>
    <div class="shape-grid">
        <div class="shape-btn active" onclick="app.setShape('cube')">
            <span>Küp</span>
        </div>
        <div class="shape-btn" onclick="app.setShape('sphere')">
            <span>Küre</span>
        </div>
        <div class="shape-btn" onclick="app.setShape('cylinder')">
            <span>Silindir</span>
        </div>
        <div class="shape-btn" onclick="app.setShape('cone')">
            <span>Koni</span>
        </div>
    </div>

    <div class="section-header mt-4">Boyutlar</div>
    <div class="flex flex-col gap-3">
        <div class="control-group">
            <div class="slider-label">
                <span id="lblDim1">Kenar (a)</span>
                <span id="valDim1">5</span>
            </div>
            <input type="range" id="slDim1" min="1" max="10" step="0.1" value="5">
        </div>
        
        <div class="control-group" id="grpDim2" style="display:none;">
            <div class="slider-label">
                <span id="lblDim2">Yükseklik (h)</span>
                <span id="valDim2">5</span>
            </div>
            <input type="range" id="slDim2" min="1" max="10" step="0.1" value="5">
        </div>
    </div>

    <div class="section-header mt-auto">Hesaplamalar</div>
    <div class="calc-card">
        <div class="calc-row">
            <span class="calc-label">Hacim (V)</span>
            <span class="calc-val" id="resVol">125.0 <span class="calc-unit">br³</span></span>
        </div>
        <div class="calc-row">
            <span class="calc-label">Yüzey Alanı (A)</span>
            <span class="calc-val" id="resArea">150.0 <span class="calc-unit">br²</span></span>
        </div>
    </div>
</aside>

<main>
    <div class="canvas-container">
        <canvas id="canvas3D"></canvas>
        
        <div class="formula-card">
            <div class="formula-title" id="fTitle">KÜP FORMÜLLERİ</div>
            <div class="formula-row">
                <span class="f-label">Hacim:</span>
                <span class="f-math" id="fVol">a³</span>
            </div>
            <div class="formula-row">
                <span class="f-label">Alan:</span>
                <span class="f-math" id="fArea">6a²</span>
            </div>
        </div>
    </div>
</main>

<script>
    const app = {
        canvas: document.getElementById('canvas3D'),
        ctx: null,
        width: 0, height: 0,
        
        shape: 'cube',
        dim1: 5, // r veya a
        dim2: 5, // h

        // 3D Engine State
        rotX: -0.4, 
        rotY: -0.5,
        vertices: [],
        edges: [],
        
        init() {
            this.ctx = this.canvas.getContext('2d');
            
            // Resize
            const resizeObserver = new ResizeObserver(() => this.resize());
            resizeObserver.observe(this.canvas.parentElement);

            // Inputs
            document.getElementById('slDim1').addEventListener('input', (e) => {
                this.dim1 = parseFloat(e.target.value);
                document.getElementById('valDim1').innerText = this.dim1;
                this.updateModel();
            });
            document.getElementById('slDim2').addEventListener('input', (e) => {
                this.dim2 = parseFloat(e.target.value);
                document.getElementById('valDim2').innerText = this.dim2;
                this.updateModel();
            });

            // Mouse Rotate
            let isDragging = false;
            let lastX, lastY;

            const start = (e) => { isDragging=true; lastX = e.clientX || e.touches[0].clientX; lastY = e.clientY || e.touches[0].clientY; };
            const move = (e) => {
                if(!isDragging) return;
                const x = e.clientX || e.touches[0].clientX;
                const y = e.clientY || e.touches[0].clientY;
                this.rotY += (x - lastX) * 0.01;
                this.rotX += (y - lastY) * 0.01;
                lastX = x; lastY = y;
                this.draw();
            };
            const end = () => isDragging=false;

            this.canvas.addEventListener('mousedown', start);
            window.addEventListener('mousemove', move);
            window.addEventListener('mouseup', end);
            this.canvas.addEventListener('touchstart', start, {passive:false});
            window.addEventListener('touchmove', move, {passive:false});
            window.addEventListener('touchend', end);

            this.setShape('cube');
            this.loop();
        },

        resize() {
            const p = this.canvas.parentElement;
            this.width = p.clientWidth;
            this.height = p.clientHeight;
            this.canvas.width = this.width;
            this.canvas.height = this.height;
            this.draw();
        },

        setShape(s) {
            this.shape = s;
            
            // UI Güncelle
            document.querySelectorAll('.shape-btn').forEach(b => b.classList.remove('active'));
            // Basitlik için sırasına göre active yapıyoruz (gerçek projede ID ile yapılır)
            const btns = document.querySelectorAll('.shape-btn');
            if(s==='cube') btns[0].classList.add('active');
            if(s==='sphere') btns[1].classList.add('active');
            if(s==='cylinder') btns[2].classList.add('active');
            if(s==='cone') btns[3].classList.add('active');

            // Inputları Ayarla
            const grp2 = document.getElementById('grpDim2');
            const lbl1 = document.getElementById('lblDim1');
            
            if(s === 'cube') {
                lbl1.innerText = "Kenar (a)";
                grp2.style.display = 'none';
                document.getElementById('fTitle').innerText = "KÜP FORMÜLLERİ";
                document.getElementById('fVol').innerText = "a³";
                document.getElementById('fArea').innerText = "6a²";
            } else if(s === 'sphere') {
                lbl1.innerText = "Yarıçap (r)";
                grp2.style.display = 'none';
                document.getElementById('fTitle').innerText = "KÜRE FORMÜLLERİ";
                document.getElementById('fVol').innerText = "4/3·π·r³";
                document.getElementById('fArea').innerText = "4·π·r²";
            } else if(s === 'cylinder') {
                lbl1.innerText = "Yarıçap (r)";
                grp2.style.display = 'block';
                document.getElementById('lblDim2').innerText = "Yükseklik (h)";
                document.getElementById('fTitle').innerText = "SİLİNDİR FORMÜLLERİ";
                document.getElementById('fVol').innerText = "π·r²·h";
                document.getElementById('fArea').innerText = "2πr(r+h)";
            } else if(s === 'cone') {
                lbl1.innerText = "Yarıçap (r)";
                grp2.style.display = 'block';
                document.getElementById('lblDim2').innerText = "Yükseklik (h)";
                document.getElementById('fTitle').innerText = "KONİ FORMÜLLERİ";
                document.getElementById('fVol').innerText = "1/3·π·r²·h";
                document.getElementById('fArea').innerText = "πr(r+l)";
            }

            this.updateModel();
        },

        updateModel() {
            this.vertices = [];
            this.edges = [];
            
            // Scale faktörü (Ekrana sığdırmak için)
            const S = 20; 

            if(this.shape === 'cube') {
                const a = this.dim1 * S / 2;
                // Köşeler
                this.vertices = [
                    {x:-a, y:-a, z:-a}, {x:a, y:-a, z:-a}, {x:a, y:a, z:-a}, {x:-a, y:a, z:-a},
                    {x:-a, y:-a, z:a}, {x:a, y:-a, z:a}, {x:a, y:a, z:a}, {x:-a, y:a, z:a}
                ];
                // Kenarlar
                this.edges = [
                    [0,1], [1,2], [2,3], [3,0], // Arka
                    [4,5], [5,6], [6,7], [7,4], // Ön
                    [0,4], [1,5], [2,6], [3,7]  // Bağlantılar
                ];
                
                // Hesapla
                const V = Math.pow(this.dim1, 3);
                const A = 6 * Math.pow(this.dim1, 2);
                this.updateCalc(V, A);

            } else if(this.shape === 'sphere') {
                const r = this.dim1 * S;
                // Wireframe Küre (Enlem/Boylam)
                const lat = 8, lon = 12;
                
                // Noktaları oluştur
                for(let i=0; i<=lat; i++) {
                    const theta = i * Math.PI / lat;
                    const sinTheta = Math.sin(theta);
                    const cosTheta = Math.cos(theta);
                    
                    for(let j=0; j<=lon; j++) {
                        const phi = j * 2 * Math.PI / lon;
                        const x = r * sinTheta * Math.cos(phi);
                        const y = r * cosTheta; // Y yukarı
                        const z = r * sinTheta * Math.sin(phi);
                        this.vertices.push({x,y,z});
                    }
                }
                
                // Kenarları bağla
                for(let i=0; i<lat; i++) {
                    for(let j=0; j<lon; j++) {
                        const p1 = i * (lon+1) + j;
                        const p2 = p1 + 1;
                        const p3 = (i+1) * (lon+1) + j;
                        this.edges.push([p1, p2]); // Yatay
                        this.edges.push([p1, p3]); // Dikey
                    }
                }

                const V = (4/3) * Math.PI * Math.pow(this.dim1, 3);
                const A = 4 * Math.PI * Math.pow(this.dim1, 2);
                this.updateCalc(V, A);

            } else if (this.shape === 'cylinder') {
                const r = this.dim1 * S;
                const h = this.dim2 * S;
                const seg = 16;
                
                // Alt ve Üst daireler
                for(let i=0; i<seg; i++) {
                    const theta = i * 2 * Math.PI / seg;
                    const x = r * Math.cos(theta);
                    const z = r * Math.sin(theta);
                    this.vertices.push({x, y: -h/2, z}); // Üst
                    this.vertices.push({x, y: h/2, z});  // Alt
                }

                for(let i=0; i<seg; i++) {
                    const top = i*2;
                    const bot = i*2+1;
                    const nextTop = ((i+1)%seg)*2;
                    const nextBot = ((i+1)%seg)*2+1;
                    
                    this.edges.push([top, nextTop]); // Üst çember
                    this.edges.push([bot, nextBot]); // Alt çember
                    this.edges.push([top, bot]);     // Yan çizgiler
                }

                const V = Math.PI * Math.pow(this.dim1, 2) * this.dim2;
                const A = 2*Math.PI*this.dim1*(this.dim1 + this.dim2);
                this.updateCalc(V, A);

            } else if (this.shape === 'cone') {
                const r = this.dim1 * S;
                const h = this.dim2 * S;
                const seg = 16;
                
                this.vertices.push({x:0, y:-h/2, z:0}); // Tepe
                
                // Taban dairesi
                for(let i=0; i<seg; i++) {
                    const theta = i * 2 * Math.PI / seg;
                    const x = r * Math.cos(theta);
                    const z = r * Math.sin(theta);
                    this.vertices.push({x, y: h/2, z});
                }

                for(let i=1; i<=seg; i++) {
                    const curr = i;
                    const next = (i % seg) + 1;
                    this.edges.push([curr, next]); // Taban
                    this.edges.push([0, curr]);    // Tepeye gidenler
                }

                const l = Math.sqrt(this.dim1**2 + this.dim2**2); // Ana doğru
                const V = (1/3) * Math.PI * Math.pow(this.dim1, 2) * this.dim2;
                const A = Math.PI * this.dim1 * (this.dim1 + l);
                this.updateCalc(V, A);
            }
            
            this.draw();
        },

        updateCalc(v, a) {
            document.getElementById('resVol').innerHTML = v.toFixed(1) + ' <span class="calc-unit">br³</span>';
            document.getElementById('resArea').innerHTML = a.toFixed(1) + ' <span class="calc-unit">br²</span>';
        },

        project(x, y, z) {
            // 3D Dönüşüm Matrisi (Basit Euler)
            // Y ekseni etrafında
            let x1 = x * Math.cos(this.rotY) - z * Math.sin(this.rotY);
            let z1 = x * Math.sin(this.rotY) + z * Math.cos(this.rotY);
            
            // X ekseni etrafında
            let y2 = y * Math.cos(this.rotX) - z1 * Math.sin(this.rotX);
            let z2 = y * Math.sin(this.rotX) + z1 * Math.cos(this.rotX);

            // Perspektif
            const fov = 400;
            const distance = 400; // Kamera uzaklığı
            const scale = fov / (distance + z2);
            
            return {
                x: this.width/2 + x1 * scale,
                y: this.height/2 + y2 * scale
            };
        },

        draw() {
            if(!this.ctx) return;
            this.ctx.clearRect(0, 0, this.width, this.height);
            
            // Izgara (Opsiyonel ama derinlik hissi için iyi)
            /*
            this.ctx.strokeStyle = '#f1f5f9';
            this.ctx.beginPath();
            this.ctx.moveTo(0, this.height/2); this.ctx.lineTo(this.width, this.height/2);
            this.ctx.moveTo(this.width/2, 0); this.ctx.lineTo(this.width/2, this.height);
            this.ctx.stroke();
            */

            const projected = this.vertices.map(v => this.project(v.x, v.y, v.z));

            this.ctx.strokeStyle = '#334155';
            this.ctx.lineWidth = 2;
            this.ctx.lineCap = 'round';
            this.ctx.lineJoin = 'round';

            // Kenarları Çiz
            this.ctx.beginPath();
            for(let edge of this.edges) {
                const p1 = projected[edge[0]];
                const p2 = projected[edge[1]];
                this.ctx.moveTo(p1.x, p1.y);
                this.ctx.lineTo(p2.x, p2.y);
            }
            this.ctx.stroke();

            // Köşeleri Çiz (Estetik)
            this.ctx.fillStyle = '#f97316';
            for(let p of projected) {
                this.ctx.beginPath();
                this.ctx.arc(p.x, p.y, 3, 0, Math.PI*2);
                this.ctx.fill();
            }
        },

        loop() {
            // Animasyon döngüsü (şu an event-based çizim yetiyor ama yumuşak dönüş için eklenebilir)
            requestAnimationFrame(() => this.loop());
        }
    };

    app.init();
</script>
</body>
</html>
