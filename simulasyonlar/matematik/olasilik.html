<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Olasılık Laboratuvarı | Teorim</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-app: #f8fafc;
            --bg-panel: #ffffff;
            --col-accent: #f97316; /* Turuncu Ana Renk */
            --text-main: #334155;
            --text-muted: #94a3b8;
            --border: #e2e8f0;
            --radius: 20px;
        }

        body { 
            margin: 0; background: var(--bg-app); 
            font-family: 'Inter', sans-serif; 
            height: 100vh; display: flex; overflow: hidden; color: var(--text-main);
        }

        /* MOBİL UYARI */
        #mobile-warning { 
            display: none; position: fixed; inset: 0; 
            background: #0f172a; color: white; z-index: 9999; 
            flex-direction: column; align-items: center; justify-content: center; 
            text-align: center; padding: 20px; 
        }
        @media (max-width: 768px) or (orientation: portrait) { #mobile-warning { display: flex; } }
        .phone-icon { animation: phoneBounce 1.5s infinite ease-in-out; }
        @keyframes phoneBounce {
            0%, 100% { transform: translateY(0) rotate(-5deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        /* SOL PANEL */
        aside { 
            width: 360px; flex-shrink: 0; background: var(--bg-panel); 
            border-right: 1px solid var(--border); padding: 24px; 
            display: flex; flex-direction: column; gap: 24px; 
            z-index: 30; box-shadow: 10px 0 30px rgba(0,0,0,0.02);
            overflow-y: auto;
        }

        .section-header {
            font-size: 0.7rem; font-weight: 800; color: var(--text-muted);
            text-transform: uppercase; letter-spacing: 1.5px;
            margin-bottom: 12px; border-bottom: 1px solid var(--border); padding-bottom: 6px;
        }

        /* MOD SEÇİCİ */
        .mode-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; }
        .mode-btn {
            padding: 12px; border: 1px solid var(--border); background: #f8fafc;
            border-radius: 12px; cursor: pointer; font-weight: 600; color: var(--text-muted);
            transition: all 0.2s; font-size: 0.85rem; text-align: center;
        }
        .mode-btn:hover { background: #fff7ed; color: var(--col-accent); border-color: var(--col-accent); }
        .mode-btn.active { background: var(--col-accent); color: white; border-color: var(--col-accent); box-shadow: 0 4px 10px rgba(249, 115, 22, 0.3); }

        /* İSTATİSTİK KARTI */
        .stats-card {
            background: #f8fafc; padding: 20px; border-radius: var(--radius);
            border: 1px solid var(--border);
        }
        .stat-row { 
            display: flex; justify-content: space-between; 
            margin-bottom: 8px; font-size: 0.85rem; border-bottom: 1px dashed var(--border); padding-bottom: 4px;
        }
        .stat-val { font-family: 'Menlo', monospace; font-weight: 700; color: var(--text-main); }
        
        .total-display {
            margin-top: 15px; padding-top: 10px; border-top: 2px solid var(--border); text-align: center;
        }
        .total-num { font-size: 2.5rem; font-weight: 900; color: var(--text-main); line-height: 1; }
        .total-lbl { font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; font-weight: 700; letter-spacing: 1px; }

        /* BUTONLAR */
        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .action-btn {
            padding: 14px; border-radius: 12px; border: none; font-weight: 700; cursor: pointer;
            transition: all 0.2s; font-size: 0.85rem;
        }
        .btn-run { background: var(--text-main); color: white; }
        .btn-run:hover { background: #0f172a; transform: translateY(-2px); }
        
        .btn-fast { background: #e0e7ff; color: #4338ca; }
        .btn-fast:hover { background: #c7d2fe; }
        
        .btn-reset { background: #f1f5f9; color: #64748b; grid-column: span 2; }
        .btn-reset:hover { background: #e2e8f0; color: #0f172a; }

        /* BİLGİ KUTUSU */
        .info-box { 
            margin-top: auto; background: #fff7ed; 
            border: 1px solid #ffedd5; border-left: 4px solid var(--col-accent); 
            padding: 15px; border-radius: 12px; 
            font-size: 0.8rem; line-height: 1.5; color: #9a3412;
        }

        /* ANA ALAN (DÜZELTİLDİ) */
        main { 
            flex: 1; display: flex; flex-direction: column; 
            padding: 24px; gap: 24px; background: #f8fafc;
            overflow: hidden; /* Ana alanın taşmasını önle */
        }

        .stage-area {
            flex: 1.2; /* Üst kısım biraz daha büyük */
            background: white; border-radius: var(--radius);
            border: 1px solid var(--border); box-shadow: 0 10px 30px -10px rgba(0,0,0,0.05);
            display: flex; justify-content: center; align-items: center;
            position: relative; overflow: hidden; 
            min-height: 200px;
        }
        
        .chart-area {
            flex: 1; /* Alt kısım */
            background: white; border-radius: var(--radius);
            border: 1px solid var(--border); box-shadow: 0 10px 30px -10px rgba(0,0,0,0.05);
            padding: 20px; position: relative;
            overflow: hidden; /* DÜZELTME: Grafiğin dışarı taşmasını engeller */
            min-height: 200px;
            display: flex; /* Canvas'ın doğru boyutlanması için */
        }
        /* Canvas'ın boyutlarını JS kontrol edecek */
        canvas { display: block; }

        /* --- NESNELER (YENİ TASARIMLAR) --- */
        /* PARA (Soft & Modern) */
        .coin {
            width: 130px; height: 130px; border-radius: 50%;
            /* Yumuşak altın gradyan */
            background: linear-gradient(145deg, #fbbf24, #f59e0b);
            border: 4px solid #fde68a;
            box-shadow: 0 8px 20px rgba(245, 158, 11, 0.25);
            display: flex; justify-content: center; align-items: center;
            font-size: 2.5rem; font-weight: 800; color: white; /* Beyaz yazı */
            text-transform: uppercase;
            position: relative;
        }
        .coin-inner { 
            width: 88%; height: 88%; border-radius: 50%; border: 2px dashed rgba(255,255,255,0.5); 
            display: flex; justify-content: center; align-items: center;
        }

        /* ZAR (Soft) */
        .dice {
            width: 110px; height: 110px; background: white;
            border-radius: 24px; border: 2px solid #e2e8f0;
            box-shadow: 0 15px 35px rgba(0,0,0,0.08);
            display: grid; padding: 12px; position: relative;
        }
        .dot { background: #475569; border-radius: 50%; width: 20px; height: 20px; position: absolute; box-shadow: inset 1px 1px 2px rgba(0,0,0,0.2); }

        /* ÇARK (Pastel & Clean) */
        .spinner-container { position: relative; width: 200px; height: 200px; }
        .spinner {
            width: 100%; height: 100%; border-radius: 50%; 
            border: 4px solid #e2e8f0; /* İnce, açık gri çerçeve */
            /* Pastel renkler */
            background: conic-gradient(#fdba74 0deg 90deg, #93c5fd 90deg 180deg, #86efac 180deg 270deg, #fde047 270deg 360deg);
            box-shadow: 0 10px 30px -10px rgba(0,0,0,0.1);
            transition: transform 2.5s cubic-bezier(0.15, 0.9, 0.3, 1);
        }
        .arrow {
            position: absolute; top: -18px; left: 50%; transform: translateX(-50%);
            width: 0; height: 0; z-index: 10;
            /* Daha kibar ok */
            border-left: 12px solid transparent; border-right: 12px solid transparent; border-top: 24px solid #475569;
            filter: drop-shadow(0 2px 3px rgba(0,0,0,0.15));
        }

        /* ANİMASYONLAR */
        .animate-flip { animation: flip 0.6s ease-out; }
        @keyframes flip { 
            0% { transform: rotateY(0) translateY(0); } 
            50% { transform: rotateY(900deg) translateY(-80px) scale(1.1); } 
            100% { transform: rotateY(0) translateY(0) scale(1); } 
        }
        
        .animate-roll { animation: roll 0.6s cubic-bezier(0.2, 0.8, 0.2, 1); }
        @keyframes roll { 
            0% { transform: rotate(0) rotateX(0) scale(0.8); } 
            50% { transform: rotate(720deg) rotateX(360deg) scale(1.1); } 
            100% { transform: rotate(1080deg) rotateX(0) scale(1); } 
        }

    </style>
</head>
<body>

    <div id="mobile-warning">
        <div class="phone-icon mb-6">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-20 w-20 text-orange-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" />
            </svg>
        </div>
        <h2 class="text-2xl font-bold mb-2">Yatay Moda Geçin</h2>
        <p class="text-slate-400 text-sm max-w-xs">Grafikleri ve deney sahnesini görmek için ekranı çevirin.</p>
    </div>

<aside>
    <div class="flex items-center gap-3 mb-2">
        <a href="../../dersler/matematik.html" class="p-2 hover:bg-orange-50 rounded-full text-orange-600 transition">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
        </a>
        <h1 class="font-bold text-xl text-slate-800">Olasılık Laboratuvarı</h1>
    </div>

    <div class="section-header">Deney Modu</div>
    <div class="mode-grid">
        <button class="mode-btn active" onclick="app.setMode('coin')">Para</button>
        <button class="mode-btn" onclick="app.setMode('dice')">Zar</button>
        <button class="mode-btn" onclick="app.setMode('spinner')">Çark</button>
    </div>

    <div class="section-header mt-4">İstatistikler</div>
    <div class="stats-card">
        <div id="statsList" class="flex flex-col gap-1">
            </div>
        <div class="total-display">
            <div class="total-num" id="dispTotal">0</div>
            <div class="total-lbl">Toplam Deneme</div>
        </div>
    </div>

    <div class="controls mt-4">
        <button class="action-btn btn-run" onclick="app.playOnce()">TEK DENEME</button>
        <button class="action-btn btn-fast" onclick="app.playBatch(50)">+50 HIZLI</button>
        <button class="action-btn btn-reset" onclick="app.reset()">SIFIRLA</button>
    </div>

    <div class="info-box" id="infoText">
        </div>
</aside>

<main>
    <div class="stage-area" id="stageArea">
        </div>

    <div class="chart-area">
        <canvas id="chartCanvas"></canvas>
    </div>
</main>

<script>
    const app = {
        mode: 'coin', 
        total: 0,
        data: {}, 
        options: [], 
        colors: [],
        chartCtx: document.getElementById('chartCanvas').getContext('2d'),

        init: function() {
            this.setMode('coin');
            // Pencere boyutu değiştiğinde grafiği yeniden çiz (taşmayı önlemek için kritik)
            window.addEventListener('resize', () => {
                 // Kısa bir gecikme ekleyerek layout'un oturmasını bekle
                 setTimeout(() => this.drawChart(), 100);
            });
        },

        setMode: function(m) {
            this.mode = m;
            this.total = 0;
            
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
            const btns = document.querySelectorAll('.mode-btn');
            if(m==='coin') btns[0].classList.add('active');
            if(m==='dice') btns[1].classList.add('active');
            if(m==='spinner') btns[2].classList.add('active');

            if (m === 'coin') {
                this.options = ['Yazı', 'Tura'];
                // Daha yumuşak turuncu/sarı
                this.colors = ['#fbbf24', '#fbbf24']; 
                document.getElementById('infoText').innerHTML = "<b>Para Atma Deneyi:</b><br>Bir madeni paranın iki yüzü vardır. Teorik olasılık her yüz için %50'dir.";
            } else if (m === 'dice') {
                this.options = ['1', '2', '3', '4', '5', '6'];
                // Daha yumuşak mavi
                this.colors = Array(6).fill('#60a5fa'); 
                document.getElementById('infoText').innerHTML = "<b>Zar Atma Deneyi:</b><br>Hilesiz bir zarda her sayının gelme olasılığı teorik olarak 1/6 (yaklaşık %16.6)'dır.";
            } else { 
                this.options = ['Turuncu', 'Mavi', 'Yeşil', 'Sarı'];
                // Pastel tonlar
                this.colors = ['#fbbf24', '#60a5fa', '#4ade80', '#facc15'];
                document.getElementById('infoText').innerHTML = "<b>Çarkıfelek Deneyi:</b><br>Dört eşit dilimli bir çark. Her rengin gelme olasılığı %25'tir.";
            }

            this.data = {};
            this.options.forEach(opt => this.data[opt] = 0);
            
            this.updateStats();
            this.renderStage(); 
            // Mod değiştiğinde grafiğin oturması için azıcık bekle
            setTimeout(() => this.drawChart(), 50);
        },

        reset: function() {
            this.total = 0;
            this.options.forEach(opt => this.data[opt] = 0);
            this.updateStats();
            this.drawChart();
            this.renderStage();
        },

        renderStage: function(result = null) {
            const stage = document.getElementById('stageArea');
            stage.innerHTML = ''; 

            if (this.mode === 'coin') {
                const el = document.createElement('div');
                el.className = 'coin';
                const inner = document.createElement('div'); inner.className = 'coin-inner';
                // Sonuç varsa ilk harfi, yoksa ?
                inner.innerText = result ? result.charAt(0) : '?';
                el.appendChild(inner);
                if (result) el.classList.add('animate-flip');
                stage.appendChild(el);
            } 
            else if (this.mode === 'dice') {
                const el = document.createElement('div');
                el.className = 'dice';
                if (result) el.classList.add('animate-roll');
                const num = result ? parseInt(result) : '?';
                this.createDiceDots(el, num);
                stage.appendChild(el);
            }
            else if (this.mode === 'spinner') {
                const con = document.createElement('div');
                con.className = 'spinner-container';
                const wheel = document.createElement('div');
                wheel.className = 'spinner';
                if (result) {
                    // Basit görsel döndürme efekti
                    const randRot = 1080 + Math.random() * 360; 
                    wheel.style.transform = `rotate(${randRot}deg)`;
                }
                const arrow = document.createElement('div');
                arrow.className = 'arrow';
                con.appendChild(wheel);
                con.appendChild(arrow);
                stage.appendChild(con);
            }
        },

        createDiceDots: function(el, num) {
            if (num === '?') {
                el.style.display='flex'; el.style.justifyContent='center'; el.style.alignItems='center';
                el.style.fontSize='40px'; el.style.color='#cbd5e1'; el.style.fontWeight='800'; el.innerText='?';
                return;
            }
            const pos = [
                [], 
                [{t:45, l:45}], // 1
                [{t:18, l:18}, {t:72, l:72}], // 2
                [{t:18, l:18}, {t:45, l:45}, {t:72, l:72}], // 3
                [{t:18, l:18}, {t:18, l:72}, {t:72, l:18}, {t:72, l:72}], // 4
                [{t:18, l:18}, {t:18, l:72}, {t:45, l:45}, {t:72, l:18}, {t:72, l:72}], // 5
                [{t:18, l:18}, {t:18, l:72}, {t:45, l:18}, {t:45, l:72}, {t:72, l:18}, {t:72, l:72}] // 6
            ];
            pos[num].forEach(p => {
                const d = document.createElement('div');
                d.className = 'dot';
                d.style.top = p.t + 'px';
                d.style.left = p.l + 'px';
                el.appendChild(d);
            });
        },

        playOnce: function() {
            const result = this.getRandomResult();
            this.recordResult(result);
            this.renderStage(result);
        },

        playBatch: function(count) {
            for(let i=0; i<count; i++) {
                this.recordResult(this.getRandomResult());
            }
            this.renderStage(); 
        },

        getRandomResult: function() {
            const idx = Math.floor(Math.random() * this.options.length);
            return this.options[idx];
        },

        recordResult: function(res) {
            this.data[res]++;
            this.total++;
            this.updateStats();
            this.drawChart();
        },

        updateStats: function() {
            document.getElementById('dispTotal').innerText = this.total;
            const list = document.getElementById('statsList');
            list.innerHTML = '';
            
            this.options.forEach(opt => {
                const count = this.data[opt];
                const percent = this.total > 0 ? ((count / this.total) * 100).toFixed(1) : 0;
                
                const row = document.createElement('div');
                row.className = 'stat-row';
                const label = opt.length > 7 ? opt.substring(0,6)+'..' : opt;
                row.innerHTML = `<span class="text-slate-500">${label}</span> <span class="stat-val">${count} (%${percent})</span>`;
                list.appendChild(row);
            });
        },

        drawChart: function() {
            const ctx = this.chartCtx;
            const cvs = ctx.canvas;
            
            // KRİTİK DÜZELTME: Canvas boyutunu ebeveynin (chart-area) anlık boyutuna eşitle
            // Bu, grafiğin kutudan taşmasını engeller.
            const container = cvs.parentElement;
            cvs.width = container.offsetWidth;
            cvs.height = container.offsetHeight;

            const w = cvs.width;
            const h = cvs.height;
            const pad = 35; // Kenar boşluğunu biraz artırdım
            
            ctx.clearRect(0, 0, w, h);

            // Grid (Daha yumuşak)
            ctx.beginPath();
            ctx.strokeStyle = '#f1f5f9'; ctx.lineWidth = 1;
            for(let i=1; i<5; i++) {
                const y = pad + (h - 2*pad) * (i/5);
                ctx.moveTo(pad, y); ctx.lineTo(w-pad, y);
            }
            ctx.stroke();

            // Eksenler (Daha yumuşak)
            ctx.beginPath();
            ctx.strokeStyle = '#cbd5e1'; ctx.lineWidth = 1.5;
            ctx.moveTo(pad, pad); ctx.lineTo(pad, h - pad); 
            ctx.lineTo(w - pad, h - pad); 
            ctx.stroke();

            if (this.total === 0) {
                ctx.fillStyle = "#94a3b8"; ctx.textAlign = "center"; 
                ctx.font = "bold 14px Inter";
                ctx.fillText("Veri bekleniyor...", w/2, h/2);
                return;
            }

            const barW = (w - 2*pad) / this.options.length;
            const theoreticalProb = 1 / this.options.length; 
            
            let maxPercent = 0;
            this.options.forEach(opt => {
                const p = this.data[opt] / this.total;
                if (p > maxPercent) maxPercent = p;
            });
            maxPercent = Math.max(maxPercent, theoreticalProb);
            const scaleY = (h - 2*pad) / (maxPercent * 1.2);

            this.options.forEach((opt, i) => {
                const count = this.data[opt];
                const percent = count / this.total;
                
                const barWidth = barW * 0.6;
                const x = pad + i * barW + (barW - barWidth)/2;
                const barHeight = percent * scaleY;
                const y = h - pad - barHeight;

                // Bar Çizimi (Yumuşatılmış renkler)
                ctx.fillStyle = this.colors[i];
                ctx.beginPath();
                ctx.roundRect(x, y, barWidth, barHeight, [8, 8, 0, 0]); // Daha yuvarlak köşeler
                ctx.fill();
                
                // Yüzde Yazısı
                ctx.fillStyle = "#475569"; ctx.textAlign="center"; ctx.font="bold 11px Inter";
                ctx.fillText("%" + (percent*100).toFixed(0), x + barWidth/2, y - 8);

                // Etiket
                ctx.fillStyle = "#64748b";
                ctx.fillText(opt.substring(0,3), x + barWidth/2, h - pad + 20);

                // Teorik Çizgi (Daha yumuşak mavi)
                const theoY = h - pad - (theoreticalProb * scaleY);
                ctx.strokeStyle = "#93c5fd"; 
                ctx.lineWidth = 2;
                ctx.setLineDash([6, 4]);
                ctx.beginPath();
                ctx.moveTo(pad, theoY);
                ctx.lineTo(w - pad, theoY);
                ctx.stroke();
                ctx.setLineDash([]);
            });
            
            // Teorik Etiket
            const theoY = h - pad - (theoreticalProb * scaleY);
            ctx.fillStyle = "#93c5fd"; ctx.textAlign = "right"; ctx.font = "italic 10px Inter";
            ctx.fillText("Teorik Olasılık", w - pad - 5, theoY - 5);
        }
    };

    app.init();
</script>
</body>
</html>
